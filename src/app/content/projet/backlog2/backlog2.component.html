<ng-template #myModal let-modal style="width: 1000px;">
    <div class="modal-header" style="background-color: #007bff;">
		<h4 class="modal-title" id="modal-basic-title" style="color: aliceblue;">Choisissez un projet à travailler</h4>
		<button style="background-color: antiquewhite;" type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
	</div>
	<div class="modal-body">
        <!-- <table class="table table-striped">
            <thead>
              <tr>
                <th scope="col">Nom du projet</th>
                <th scope="col">Etat actuel</th>
                <th scope="col">Créateur</th>
                <th scope="col">Résponsable</th>
              </tr>
            </thead>
            <tbody>
                <tr *ngFor="let projects of allProjects | paginate:{itemsPerPage:7, currentPage:page, totalItems:totalLength}">
                    <td style="width: 100px;"><button type="button" class="btn btn-link btn-sm btn-rounded" (click)="voirProjetDetail(projects.idProjet)">
                    {{projects.nom}}
                    </button></td>
                    <td style="width: 70px;">{{projects.etat}}</td>
                    <ng-container *ngIf="projects.idCreateur?.username; else noCreateur">
                    <td class="col-3">
                        <div *ngIf="projects.idCreateur?.photo">
                        <img
                            src="assets\{{projects.idCreateur.photo}}"
                            alt=""
                            style="width: 45px; height: 45px;cursor: pointer;"
                            class="rounded-circle"
                            title="{{projects.idCreateur.username}}"
                        />
                        </div>
                        <div *ngIf="!projects.idCreateur.photo">
                        <img
                            src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQP7NjSjKYoQFApBGgMXfrAioIDBfleCIZWyA&usqp=CAU"
                            alt=""
                            style="width: 45px; height: 45px;cursor: pointer;"
                            class="rounded-circle"
                            title="{{projects.idCreateur.username}}"
                        />
                        </div>
                    </td>
                    </ng-container>
                    <ng-template #noCreateur>
                        <td ngbDropdown class="col-3">
                            <img
                                src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/7e/Circle-icons-profile.svg/1200px-Circle-icons-profile.svg.png"
                                alt=""
                                style="width: 45px; height: 45px;cursor: pointer;"
                                class="rounded-circle"
                                title="Ajouter user"
                            />
                        </td>
                    </ng-template>
                    <ng-container *ngIf="projects.idResponsable?.username; else noCreateure">
                        <td class="col-2">
                            <div *ngIf="projects.idResponsable?.photo">
                                <img
                                    src="assets\{{projects.idResponsable.photo}}"
                                    alt=""
                                    style="width: 45px; height: 45px;cursor: pointer;"
                                    class="rounded-circle"
                                    title="{{projects.idResponsable.username}}"
                                />
                            </div>
                            <div *ngIf="!projects.idResponsable.photo">
                                <img
                                    src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQP7NjSjKYoQFApBGgMXfrAioIDBfleCIZWyA&usqp=CAU"
                                    alt=""
                                    style="width: 45px; height: 45px;cursor: pointer;"
                                    class="rounded-circle"
                                    title="{{projects.idResponsable.username}}"
                                />
                            </div>
                        </td>
                    </ng-container>
                    <ng-template #noCreateure>
                        <td ngbDropdown class="col-2">
                            <img
                                src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/7e/Circle-icons-profile.svg/1200px-Circle-icons-profile.svg.png"
                                alt=""
                                style="width: 45px; height: 45px"
                                class="rounded-circle"
                                title="Ajouter user"
                            />
                        </td>
                    </ng-template>
                    <td class="col-2"><button class="btn btn-primary" (click)="choixProjet(projects.idProjet)">Choisir</button></td>
                </tr>
            </tbody>
        </table> -->
        <table class="table table-striped">
            <thead>
              <tr>
                <th scope="col">Nom du projet</th>
                <th scope="col">Etat actuel</th>
                <th scope="col">Temps restant</th>
                <th scope="col">Avancement en jour</th>
                <th scope="col">Avancement projet</th>
                <th scope="col">Observation</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let projects of allProjects | paginate:{itemsPerPage:7, currentPage:page, totalItems:totalLength}">
                <td style="width: 70px;"><button type="button" class="btn btn-link btn-sm btn-rounded" (click)="voirProjetDetail(projects.idProjet)">
                  {{projects.nom}}
                </button></td>
                <td style="width: 70px;">{{projects.etat}}</td>
                <td style="width: 70px;" *ngIf="projects.daysLeft">
                  <b *ngIf="projects.daysLeft > 0 && projects.daysLeft < 7 && projects.etat != 'Terminé'" style="color: red">{{projects.daysLeft}} jour(s)</b>
                  <b *ngIf="projects.daysLeft > 0 && projects.daysLeft >= 7 && projects.etat != 'Terminé'" style="color: green">{{projects.daysLeft}} jour(s)</b>
                  <b *ngIf="projects.daysLeft < 0 && projects.etat != 'Terminé'" style="color: rgb(190, 45, 9)">{{projects.daysLeft}} jour(s)</b>
                </td>
                <td style="width: 70px;" *ngIf="projects.daysLeft == 0" style="color: red">temp écoulé</td>
                <td style="width: 70px;" *ngIf="projects.daysLeft == null"></td>
                <td style="width: 70px;" *ngIf="projects.avancementJ">{{projects.avancementJ.toFixed(2)}}%</td>
                <td style="width: 70px;" *ngIf="projects.avancementJ == -0">0%</td>
                <td style="width: 70px;" *ngIf="!projects.avancementJ && projects.daysLeft == 0">Date debut = date fin</td>
                <td style="width: 70px;" *ngIf="projects.avancementJ == null">Date debut et/ou date fin non défini</td>
                <td style="width: 70px;" *ngIf="projects.avancementP">{{projects.avancementP.toFixed(2)}} %</td>
                <td style="width: 70px;" *ngIf="!projects.avancementP">0 %</td>
                <td style="width: 70px;color: red" *ngIf="projects.avancementP && projects.avancementJ && projects.avancementP <= projects.avancementJ && projects.etat != 'Terminé'">en retard</td>
                <td style="width: 70px;color: green" *ngIf="projects.avancementP && projects.avancementJ && projects.avancementP > projects.avancementJ && projects.etat != 'Terminé'">en avance</td>
                <td style="width: 70px;" *ngIf="!projects.avancementP || !projects.avancementJ"></td>
                <td class="col-2"><button class="btn btn-primary" (click)="choixProjet(projects.idProjet)">Choisir</button></td>
              </tr>
            </tbody>
          </table>
          
        <div class="pagination align-items-end">
            <pagination-controls (pageChange)="page=$event"></pagination-controls>
        </div>
	</div>
</ng-template>

<ng-template #BacklogDetail let-modal style="width: 1000px;">
    <div class="modal-header" style="background-color: #007bff;">
		<h4 class="modal-title" id="modal-basic-title" style="color: aliceblue;">Détails backlog</h4>
		<button style="background-color: antiquewhite;" type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
	</div>
    <div class="modal-body" *ngIf="backlogSelected">
        <div class="body">
            <div class="col-lg-12">
                <div class="row">
                    <div class="col-md-8" style="max-height: 661px; overflow: auto;" ngbDropdown>
                        <h4>{{backlogSelected.nom}}</h4>
                        <strong style="cursor: pointer">Description:</strong>
                        <p>{{backlogSelected.description}}</p>
                        <div class="card" style="width: 100%;">
                            <div (click)="tacheCollapses.toggle()" style="margin: 12px;cursor: pointer;">
                                <i class="bi bi-chevron-down">&nbsp;</i><b>Modules</b>
                            </div>
                            <div id="collapseExample" mdbCollapse #tacheCollapses="mdbCollapse" style="position: static;">                               
                                <div *ngFor="let fonctionnalite of fonctionnalitesBacklog" style="height: 100%;margin-left: 10px;margin-right: 10px;width: 96%">
                                    <div *ngIf="tachesFonctionnalite2 && fonctionnalite.backlog.id == backlogSelected.id" class="example-list">
                                        <div class="example-box" style="cursor: pointer;" (click)="openFonctionnaliteModal(FonctionnaliteDetail,fonctionnalite)">
                                            <div style="float: left"><b>{{fonctionnalite.nom}}</b></div>
                                            <div style="float: right;margin-right: 15px;">{{getAvanceFonctionnalite(fonctionnalite).toFixed(1)}} %</div>
                                        </div>
                                    </div>
                                </div>
                                <div style="height: 100%;margin-left: 10px;margin-right: 10px;width: 96%">
                                    <input *ngIf="creatingTache" type="text" placeholder="Nom du fonctionnalite" [(ngModel)]="fonctionnaliteName" class="form-control col-md-12">
                                    <button *ngIf="!creatingTache && (isScrumMaster() || isProductOwner() || isAdmin())" (click)="creatingTache = true" class="btn btn-light col-md-12 text-center">Nouvelle Module</button>
                                    <button *ngIf="creatingTache && fonctionnaliteName" (click)="createFonctionnalite(backlogSelected)" class="btn btn-light col-md-12 text-center">Créer Module</button>
                                    <button *ngIf="creatingTache && !fonctionnaliteName" (click)="creatingTache = false" class="btn btn-light col-md-12 text-center">Annuler</button>
                                </div>
                            </div>
                        </div>
                        <div class="js-upload-finished">
                            <div class="col">
                                <div  id="collapseExample"  style="position: static;">
                                    <strong>Commentaire</strong>
                                    <div class="col-md-12 h-100 p-2 bg-light border rounded-3">
                                        <div id="collapseExample" style="position: static;">
                                            <textarea style="width: 100%;" [(ngModel)]="newCommentaireBacklog.commentaire"></textarea>
                                            <a class="list-group-item list-group-item-info" style="cursor: pointer;" *ngIf="fileNameBacklog">
                                                {{fileNameBacklog}} (ajouter un commentaire et/ou clickez sur <b>commenter</b> pour uploader le fichier.)</a>
                                            <button type="button" class="btn btn-outline-primary border-0 btn-sm" 
                                                style="float: right;" (click)="fileInput.click()">Upload fichier
                                            </button>
                                            <form class="mx-1 mx-md-4" (ngSubmit)="commentaireWithFileBacklog(myGroup)" ngNativeValidate>          
                                                <div [formGroup]="myGroup" enctype="multipart/form-data">
                                                    <input type="file" #fileInput style="display: none" (change)="uploadFileCommentBacklog($event,myGroup)">
                                                    <button *ngIf="fileNameBacklog && newCommentaireBacklog.commentaire" style="float: right;" class="btn btn-success border-0 btn-sm">Commenter</button>
                                                    <button *ngIf="fileNameBacklog && !newCommentaireBacklog.commentaire" style="float: right;" class="btn btn-success border-0 btn-sm" disabled>Commenter</button>
                                                </div>
                                            </form>
                                            &nbsp;
                                            <button *ngIf="!fileNameBacklog && newCommentaireBacklog.commentaire" type="button" (click)="commenterBacklog(backlogSelected)" class="btn btn-primary border-0 btn-sm" style="float: right;">Commenter</button>
                                            <button *ngIf="!fileNameBacklog && !newCommentaireBacklog.commentaire" type="button" class="btn btn-primary border-0 btn-sm" style="float: right;" disabled>Commenter</button>
                                            <div class="list-group list-group-light" style="width: 100%;" *ngIf="commentairesBacklog">
                                                <div class="list-group-item list-group-item-action" style="height: auto" *ngFor="let com of commentairesBacklog">
                                                    <div *ngIf="com.createur.photo">
                                                        <img
                                                            src="assets/{{com.createur.photo}}"
                                                            alt=""
                                                            style="width: 45px; height: 45px"
                                                            class="rounded-circle"
                                                        />&nbsp;
                                                    </div>
                                                    <div *ngIf="!com.createur.photo">
                                                        <img
                                                            src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQP7NjSjKYoQFApBGgMXfrAioIDBfleCIZWyA&usqp=CAU"
                                                            alt=""
                                                            style="width: 45px; height: 45px"
                                                            class="rounded-circle"
                                                        />&nbsp;
                                                    </div>
                                                    <div style="position: relative;">
                                                        <b style="position: absolute; top: -50px;left: 50px;">{{com.createur.username}}</b>
                                                        &nbsp;<i style="position: absolute; top: -25px;left: 50px;">{{com.temp}}</i><br><br>
                                                    </div>
                                                    <div *ngIf="com.file == true">
                                                        <p style="position: relative; top: -30px;"> 
                                                            <ng-container *ngIf="com.commentaire">{{com.commentaire}} <br></ng-container>
                                                            -> <button *ngIf="getCommentaireFile(com)" class="btn btn-link" (click)="onDownloadFileCommentaire(com)">{{getCommentaireFile(com)}}</button>
                                                        </p>
                                                        <!-- <p style="position: relative; top: -30px;"></p> -->
                                                        <p style="position: relative;"><button type="button" class="btn btn-link" (click)="deleteCommentaireBacklog(com.idCommentaire,backlogSelected)">Supprimer</button></p>
                                                    </div>
                                                    <div *ngIf="com.file == false">
                                                        <p style="position: relative; top: -35px;" *ngIf="com.updating == false">{{com.commentaire}}</p>
                                                        <div *ngIf="com.updating == true">
                                                            <textarea name="" id="" cols="60" rows="5" [(ngModel)]="com.commentaire"></textarea>
                                                        </div>
                                                        <p>
                                                            <button type="button" class="btn btn-link" (click)="updateCommentaireBacklog(com.idCommentaire,com,backlogSelected)">Modifier</button>
                                                            &nbsp;
                                                            <button type="button" class="btn btn-link" (click)="deleteCommentaireBacklog(com.idCommentaire,backlogSelected)">Supprimer</button>
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="d-inline-block">
                            <button type="button" class="btn btn-success" id="dropdown1" *ngIf="backlogSelected.etat == 'Terminé'">
                                {{backlogSelected.etat}}
                            </button>
                            <button *ngIf="(isAdmin() || isProductOwner()) && backlogSelected.etat == 'en attente'" (click)="basicCollapses.toggle()" type="button" class="btn btn-secondary" id="dropdown1">
                                {{backlogSelected.etat}}
                            </button>
                            <button *ngIf="!isAdmin() && !isProductOwner() && backlogSelected.etat == 'en attente'" type="button" class="btn btn-secondary" id="dropdown1">
                                {{backlogSelected.etat}}
                            </button>
                            <button type="button" class="btn btn-danger" id="dropdown1" *ngIf="backlogSelected.etat == 'Pas valable'">
                                {{backlogSelected.etat}}
                            </button>
                            <button type="button" class="btn btn-primary" id="dropdown1" *ngIf="backlogSelected.etat == 'Valable'">
                                {{backlogSelected.etat}}
                            </button>
                            <div id="collapseExample" mdbCollapse #basicCollapses="mdbCollapse" style="position: static;">
                                <div aria-labelledby="dropdown1" *ngIf="backlogSelected.etat == 'en attente'">
                                    <button type="button" (click)="setBacklogToPasValable(backlogSelected)" class="btn btn-outline-danger" id="dropdown1" >
                                        Pas valable
                                    </button><br>
                                    <button type="button" (click)="setBacklogToValable(backlogSelected)" class="btn btn-outline-primary" id="dropdown1" >
                                        Valable
                                    </button><br>
                                    <!-- <button type="button" (click)="setBacklogToTermine(backlogSelected)" class="btn btn-outline-success" id="dropdown1" >
                                        Terminé
                                    </button> -->
                                </div>
                                <!-- <div aria-labelledby="dropdown1" *ngIf="backlogSelected.etat == 'Pas valable'">
                                    <button type="button" (click)="setBacklogToEnAttente(backlogSelected)" class="btn btn-outline-secondary" id="dropdown1" >
                                        en attente
                                    </button><br>
                                    <button type="button" (click)="setBacklogToValable(backlogSelected)" class="btn btn-outline-primary" id="dropdown1" >
                                        Valable
                                    </button><br>
                                    <button type="button" (click)="setBacklogToTermine(backlogSelected)" class="btn btn-outline-success" id="dropdown1" >
                                        Terminé
                                    </button>
                                </div>
                                <div aria-labelledby="dropdown1" *ngIf="backlogSelected.etat == 'Valable'">
                                    <button type="button" (click)="setBacklogToEnAttente(backlogSelected)" class="btn btn-outline-secondary" id="dropdown1" >
                                        en attente
                                    </button><br>
                                    <button type="button" (click)="setBacklogToPasValable(backlogSelected)" class="btn btn-outline-danger" id="dropdown1" >
                                        Pas valable
                                    </button><br>
                                    <button type="button" (click)="setBacklogToTermine(backlogSelected)" class="btn btn-outline-success" id="dropdown1" >
                                        Terminé
                                    </button>
                                </div>
                                <div aria-labelledby="dropdown1" *ngIf="backlogSelected.etat == 'Terminé'">
                                    <button type="button" (click)="setBacklogToEnAttente(backlogSelected)" class="btn btn-outline-secondary" id="dropdown1" >
                                        en attente
                                    </button><br>
                                    <button type="button" (click)="setBacklogToPasValable(backlogSelected)" class="btn btn-outline-danger" id="dropdown1" >
                                        Pas valable
                                    </button><br>
                                    <button type="button" (click)="setBacklogToValable(backlogSelected)" class="btn btn-outline-primary" id="dropdown1" >
                                        Valable
                                    </button>
                                </div> -->
                            </div>
                        </div><br><br>
                        <div>
                            <table class="table">
                                <thead>
                                    <tr>
                                      <th scope="col"><b>Détails</b></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <th scope="row">Priorité</th>
                                        <td>                                       
                                            <tr>
                                                <select [(ngModel)]="priority" (change)="setPriority()" class="form-select sm">
                                                    <option class="form-select" [ngValue]="5">Urgente</option>
                                                    <option class="form-select" [ngValue]="4">élevée</option>
                                                    <option class="form-select" [ngValue]="3">Normal</option>
                                                    <option class="form-select" [ngValue]="2">Bas</option>
                                                    <option class="form-select" [ngValue]="1">Facultatif</option>
                                                </select>
                                            </tr>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th scope="row">Story point</th>
                                        <td>                                       
                                            <input [(ngModel)]="backlogSelected.storyPoint" (change)="setStoryPoint(storypoint)" type="number" class="form-select" style="width: 100px" min="0" max="10">
                                        </td>
                                    </tr>
                                    <tr>
                                        <th scope="row">Créateur</th>
                                        <td>
                                            <img *ngIf="backlogSelected.idCreateur.photo" src="assets/{{backlogSelected.idCreateur.photo}}" 
                                            style="width: 45px; height: 45px" class="rounded-circle" title="{{backlogSelected.idCreateur.username}}">
                                            <img *ngIf="!backlogSelected.idCreateur.photo" src="assets/imageDefault.jpg" 
                                            style="width: 45px; height: 45px" class="rounded-circle" title="{{backlogSelected.idCreateur.username}}">
                                        </td>
                                    </tr>
                                    <!-- <tr>
                                        <th scope="row">Responsable(s)</th>
                                        <td ngbDropdown>
                                            <ng-container *ngFor="let responsable of responsableBacklogSelected">
                                                <img *ngIf="responsable.idResponsable && responsable.idResponsable.photo" src="assets/{{responsable.idResponsable.photo}}" 
                                                style="width: 45px; height: 45px" class="rounded-circle" title="{{responsable.idResponsable.username}}">
                                                <img *ngIf="responsable.idResponsable && !responsable.idResponsable.photo" src="assets/imageDefault.jpg"
                                                style="width: 45px; height: 45px" class="rounded-circle" title="{{responsable.idResponsable.username}}">
                                            </ng-container>
                                            <img *ngIf="isScrumMasterBacklog(backlogSelected) || isProductOwner() || isAdmin()" src="assets/addUser.png" style="width: 45px; height: 45px;cursor: pointer" class="rounded-circle" title="ajouter responsable" ngbDropdownToggle>
                                            <ul *ngIf="isScrumMasterBacklog(backlogSelected) || isProductOwner() || isAdmin()" ngbDropdownMenu style="width: 250px;" class="dropdown-menu-end" aria-labelledby="navbarDropdownMenuLink">
                                                <span>Rechercher:</span>
                                                <input type="text" placeholder="Search.." name="search" [(ngModel)]="nomRecherche" (input)="getBacklogResponsableFiltered()" style="width: 120px;"><br>
                                                <span>Assigner à :</span>
                                                <li *ngFor="let user of responsableBacklogFiltered">                               
                                                    <a class="dropdown-item" style="cursor: pointer" [ngClass]="{ 'active': user.isResponsable }" (click)="assignBacklogResponsable(user)" (click)="onItemClick($event)">
                                                        <div *ngIf="user.photo">
                                                            <label style="float: left;"><img src="assets\{{user.photo}}" style="width: 30px;height: 30px;" class="rounded-circle"></label>
                                                        </div>
                                                        <div *ngIf="!user.photo">
                                                            <label style="float: left;"><img src="assets\imageDefault.jpg" style="width: 30px;height: 30px;" class="rounded-circle"></label>
                                                        </div>
                                                        &nbsp;{{user.username}}
                                                    </a>
                                                </li>
                                            </ul>
                                        </td>
                                    </tr> -->
                                    <tr>
                                        <th scope="row">Scrum master(s)</th>
                                        <td ngbDropdown>
                                            <ng-container *ngFor="let scrumMaster of scrumMastersBacklogSelected">
                                                <img *ngIf="scrumMaster.idScrumMaster && scrumMaster.idScrumMaster.photo" src="assets/{{scrumMaster.idScrumMaster.photo}}" 
                                                style="width: 45px; height: 45px" class="rounded-circle" title="{{scrumMaster.idScrumMaster.username}}">
                                                <img *ngIf="scrumMaster.idScrumMaster && !scrumMaster.idScrumMaster.photo" src="assets/imageDefault.jpg"
                                                style="width: 45px; height: 45px" class="rounded-circle" title="{{scrumMaster.idScrumMaster.username}}">
                                            </ng-container>
                                            <img *ngIf="isScrumMasterBacklog(backlogSelected) || isProductOwner() || isAdmin()" src="assets/addUser.png" style="width: 45px; height: 45px;cursor: pointer" class="rounded-circle" title="ajouter responsable" ngbDropdownToggle>
                                            <ul *ngIf="isScrumMasterBacklog(backlogSelected) || isProductOwner() || isAdmin()" ngbDropdownMenu style="width: 250px;" class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdownMenuLink">
                                                <span>Rechercher:</span>
                                                <input type="text" placeholder="Search.." name="search" [(ngModel)]="nomRecherche" (input)="getBacklogScrumMastersFiltered()" style="width: 120px;"><br>
                                                <span>Assigner à :</span>
                                                <li *ngFor="let user of scrumMastersBacklogFiltered">                               
                                                    <a class="dropdown-item" style="cursor: pointer" [ngClass]="{ 'active': user.isScrumMaster }" (click)="assignBacklogScrumMaster(user)" (click)="onItemClick($event)">
                                                        <div *ngIf="user.photo">
                                                            <label style="float: left;"><img src="assets\{{user.photo}}" style="width: 30px;height: 30px;" class="rounded-circle"></label>
                                                        </div>
                                                        <div *ngIf="!user.photo">
                                                            <label style="float: left;"><img src="assets\imageDefault.jpg" style="width: 30px;height: 30px;" class="rounded-circle"></label>
                                                        </div>
                                                        &nbsp;{{user.username}}
                                                    </a>
                                                </li>
                                            </ul>
                                        </td>
                                    </tr>
                                    <!-- <tr>
                                        <th scope="row">Développeur(s)</th>
                                        <td ngbDropdown>
                                            <ng-container *ngFor="let developpeur of developersBacklogSelected">
                                                <img *ngIf="developpeur.idDevellopers && developpeur.idDevellopers.photo" src="assets/{{developpeur.idDevellopers.photo}}" 
                                                style="width: 45px; height: 45px" class="rounded-circle" title="{{developpeur.idDevellopers.username}}">
                                                <img *ngIf="developpeur.idDevellopers && !developpeur.idDevellopers.photo" src="assets/imageDefault.jpg"
                                                style="width: 45px; height: 45px" class="rounded-circle" title="{{developpeur.idDevellopers.username}}">
                                            </ng-container>
                                            <img *ngIf="isScrumMasterBacklog(backlogSelected) || isProductOwner() || isAdmin()" src="assets/addUser.png" style="width: 45px; height: 45px;cursor: pointer" class="rounded-circle" title="ajouter responsable" ngbDropdownToggle>
                                            <ul *ngIf="isScrumMasterBacklog(backlogSelected) || isProductOwner() || isAdmin()" ngbDropdownMenu style="width: 250px;" class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdownMenuLink">
                                                <span>Rechercher:</span>
                                                <input type="text" placeholder="Search.." name="search" [(ngModel)]="nomRecherche" (input)="getBacklogDevellopersFiltered()" style="width: 120px;"><br>
                                                <span>Assigner à :</span>
                                                <li *ngFor="let user of developersBacklogFiltered">                               
                                                    <a class="dropdown-item" style="cursor: pointer" [ngClass]="{ 'active': user.isDevelopper }" (click)="assignBacklogDevellopers(user)" (click)="onItemClick($event)">
                                                        <div *ngIf="user.photo">
                                                            <label style="float: left;"><img src="assets\{{user.photo}}" style="width: 30px;height: 30px;" class="rounded-circle"></label>
                                                        </div>
                                                        <div *ngIf="!user.photo">
                                                            <label style="float: left;"><img src="assets\imageDefault.jpg" style="width: 30px;height: 30px;" class="rounded-circle"></label>
                                                        </div>
                                                        &nbsp;{{user.username}}
                                                    </a>
                                                </li>
                                            </ul>
                                        </td>
                                    </tr> -->
                                    <tr>
                                        <th scope="row">Date de début</th>
                                        <td *ngIf="backlogSelected.dateDebut"><i>{{backlogSelected.dateDebut}}</i></td>
                                        <td *ngIf="!backlogSelected.dateDebut && isScrumMasterBacklog(backlogSelected) || !backlogSelected.dateDebut && isProductOwner() || !backlogSelected.dateDebut && isAdmin()">
                                            <!-- <button class="btn btn-link" *ngIf="!addDebutTache" (click)="addDebutTache = true">
                                                <i>Ajouter date debut</i>
                                            </button> -->
                                            <input *ngIf="projetInWork.dateDebut && projetInWork.dateFin" [(ngModel)] = "dateDebut" (change)="addDateDebutToBacklog(backlogSelected.id)" 
                                            min="{{projetInWork.dateDebut}}" max="{{projetInWork.dateFin}}" class="form-control form-control-sm" type="date" style="width: 70%;">
                                            <input *ngIf="!projetInWork.dateDebut || !projetInWork.dateFin" [(ngModel)] = "dateDebut" (change)="addDateDebutToBacklog(backlogSelected.id)" 
                                            class="form-control form-control-sm" type="date" style="width: 70%;">
                                        </td>
                                    </tr>
                                    <tr>
                                        <th scope="row">Date d'échéance</th>
                                        <td *ngIf="backlogSelected.dateFin"><i>{{backlogSelected.dateFin}}</i></td>
                                        <td *ngIf="!backlogSelected.dateFin && isScrumMasterBacklog(backlogSelected) || !backlogSelected.dateFin && isProductOwner() || !backlogSelected.dateFin && isAdmin()">
                                            <!-- <button class="btn btn-link" *ngIf="!addFinTache" (click)="addFinTache = true">
                                                <i>Ajouter échéance</i>
                                            </button> -->
                                            <input *ngIf="projetInWork.dateDebut && projetInWork.dateFin" [(ngModel)] = "dateFin" (change)="addDateFinToBacklog(backlogSelected.id)" 
                                            min="{{projetInWork.dateDebut}}" max="{{projetInWork.dateFin}}" class="form-control form-control-sm" type="date" style="width: 70%;">
                                            <input *ngIf="!projetInWork.dateDebut || !projetInWork.dateFin" [(ngModel)] = "dateFin" (change)="addDateFinToBacklog(backlogSelected.id)" 
                                            class="form-control form-control-sm" type="date" style="width: 70%;">
                                        </td>
                                    </tr>
                                    <tr>
                                        <th scope="row">Terminé le</th>
                                        <td *ngIf="backlogSelected.termine"><i>{{backlogSelected.termine}}</i></td>
                                        <td *ngIf="!backlogSelected.termine"></td>
                                    </tr>
                                </tbody>
                            </table>
                            <button *ngIf="isScrumMasterBacklog(backlogSelected) || !backlogSelected.dateDebut && isProductOwner() || !backlogSelected.dateDebut && isAdmin()" class="btn btn-outline-primary" (click)="openBacklogUpdate(updateBacklog,backlogSelected)">Mettre à jour</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>        
    </div>
    <div class="modal-footer">
        <button *ngIf="isScrumMasterBacklog(backlogSelected) || isProductOwner() || isAdmin()" class="btn btn-danger float-end" (click)="deleteBacklog(backlogSelected)">Supprimer</button>
    </div>
</ng-template>

<ng-template #FonctionnaliteDetail let-modal style="width: 1000px;">
    <div class="modal-header" style="background-color: #007bff;">
		<h4 class="modal-title" id="modal-basic-title" style="color: aliceblue;">Détails Module</h4>
		<button style="background-color: antiquewhite;" type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
	</div>
    <div class="modal-body" *ngIf="fonctionnaliteSelected">
        <div class="body">
            <div class="col-lg-12">
                <div class="row">
                    <div class="col-md-8" style="max-height: 661px; overflow: auto;" ngbDropdown>
                        <h4>{{fonctionnaliteSelected.nom}}</h4>
                        <strong style="cursor: pointer">Description:</strong>
                        <p>{{fonctionnaliteSelected.description}}</p>
                        <div class="card" style="width: 100%;">
                            <div (click)="tacheCollapses.toggle()" style="margin: 12px;cursor: pointer;">
                                <i class="bi bi-chevron-down">&nbsp;</i><b>Taches</b>
                            </div>
                            <div id="collapseExample" mdbCollapse #tacheCollapses="mdbCollapse" style="position: static;">                               
                                <div *ngFor="let tache of tachesFonctionnalite" class="example-list" style="height: 100%;margin-left: 10px;margin-right: 10px;width: 96%">
                                    <div class="example-box" style="cursor: pointer" (click)="openTacheModal(TacheDetail,tache)">
                                        <div style="float: left"><b>{{tache.nom}}</b></div>
                                        <div style="float: right">{{tache.avance}} %</div>
                                    </div>
                                </div>
                                <div style="height: 100%;margin-left: 10px;margin-right: 10px;width: 96%">
                                    <input *ngIf="creatingTache" type="text" placeholder="Nom du tache" [(ngModel)]="newTacheName" class="form-control col-md-12">
                                    <button *ngIf="!creatingTache" (click)="creatingTache = true" class="btn btn-light col-md-12 text-center">Nouvelle tâche</button>
                                    <button *ngIf="creatingTache && newTacheName" (click)="createTache(fonctionnaliteSelected)" class="btn btn-light col-md-12 text-center">Créer tâche</button>
                                    <button *ngIf="creatingTache && !newTacheName" (click)="creatingTache = false" class="btn btn-light col-md-12 text-center">Annuler</button>
                                </div>
                            </div>
                        </div>
                        <div class="js-upload-finished">
                            <div class="col">
                                <div  id="collapseExample"  style="position: static;">
                                    <strong>Commentaire</strong>
                                    <div class="col-md-12 h-100 p-2 bg-light border rounded-3">
                                        <div id="collapseExample" style="position: static;">
                                            <textarea style="width: 100%;" [(ngModel)]="newCommentaireFonctionnalite.commentaire"></textarea>
                                            <a class="list-group-item list-group-item-info" style="cursor: pointer;" *ngIf="fileNameFonctionnalite">
                                                {{fileNameFonctionnalite}} (ajouter un commentaire et/ou clickez sur <b>commenter</b> pour uploader le fichier.)</a>
                                            <button type="button" class="btn btn-outline-primary border-0 btn-sm" 
                                                style="float: right;" (click)="fileInput.click()">Upload fichier
                                            </button>
                                            <form class="mx-1 mx-md-4" (ngSubmit)="commentaireWithFileFonctionnalite(myGroup)" ngNativeValidate>          
                                                <div [formGroup]="myGroup" enctype="multipart/form-data">
                                                    <input type="file" #fileInput style="display: none" (change)="uploadFileCommentFonctionnalite($event,myGroup)">
                                                    <button *ngIf="fileNameFonctionnalite && newCommentaireFonctionnalite.commentaire" style="float: right;" class="btn btn-success border-0 btn-sm">Commenter</button>
                                                    <button *ngIf="fileNameFonctionnalite && !newCommentaireFonctionnalite.commentaire" style="float: right;" class="btn btn-success border-0 btn-sm" disabled>Commenter</button>
                                                </div>
                                            </form>
                                            &nbsp;
                                            <button *ngIf="!fileNameFonctionnalite && newCommentaireFonctionnalite.commentaire" type="button" (click)="commenterFonctionnalite(fonctionnaliteSelected)" class="btn btn-primary border-0 btn-sm" style="float: right;">Commenter</button>
                                            <button *ngIf="!fileNameFonctionnalite && !newCommentaireFonctionnalite.commentaire" type="button" class="btn btn-primary border-0 btn-sm" style="float: right;" disabled>Commenter</button>
                                            <div class="list-group list-group-light" style="width: 100%;" *ngIf="commentairesFonctionnalite">
                                                <div class="list-group-item list-group-item-action" style="height: auto" *ngFor="let com of commentairesFonctionnalite">
                                                    <div *ngIf="com.createur.photo">
                                                        <img
                                                            src="assets/{{com.createur.photo}}"
                                                            alt=""
                                                            style="width: 45px; height: 45px"
                                                            class="rounded-circle"
                                                        />&nbsp;
                                                    </div>
                                                    <div *ngIf="!com.createur.photo">
                                                        <img
                                                            src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQP7NjSjKYoQFApBGgMXfrAioIDBfleCIZWyA&usqp=CAU"
                                                            alt=""
                                                            style="width: 45px; height: 45px"
                                                            class="rounded-circle"
                                                        />&nbsp;
                                                    </div>
                                                    <div style="position: relative;">
                                                        <b style="position: absolute; top: -50px;left: 50px;">{{com.createur.username}}</b>
                                                        &nbsp;<i style="position: absolute; top: -25px;left: 50px;">{{com.temp}}</i><br><br>
                                                    </div>
                                                    <div *ngIf="com.file == true">
                                                        <p style="position: relative; top: -30px;"> 
                                                            <ng-container *ngIf="com.commentaire">{{com.commentaire}} <br></ng-container>
                                                            -> <button *ngIf="getCommentaireFile(com)" class="btn btn-link" (click)="onDownloadFileCommentaire(com)">{{getCommentaireFile(com)}}</button>
                                                        </p>
                                                        <!-- <p style="position: relative; top: -30px;"></p> -->
                                                        <p style="position: relative;"><button type="button" class="btn btn-link" (click)="deleteCommentaireFonctionnalite(com.idCommentaire,fonctionnaliteSelected)">Supprimer</button></p>
                                                    </div>
                                                    <div *ngIf="com.file == false">
                                                        <p style="position: relative; top: -35px;" *ngIf="com.updating == false">{{com.commentaire}}</p>
                                                        <div *ngIf="com.updating == true">
                                                            <textarea name="" id="" cols="60" rows="5" [(ngModel)]="com.commentaire"></textarea>
                                                        </div>
                                                        <p>
                                                            <button type="button" class="btn btn-link" (click)="updateCommentaireFonctionnalite(com.idCommentaire,com,fonctionnaliteSelected)">Modifier</button>
                                                            &nbsp;
                                                            <button type="button" class="btn btn-link" (click)="deleteCommentaireFonctionnalite(com.idCommentaire,fonctionnaliteSelected)">Supprimer</button>
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="d-inline-block">
                            <button type="button" class="btn btn-secondary" id="dropdown1" *ngIf="fonctionnaliteSelected.etat == 'à faire'">
                                {{fonctionnaliteSelected.etat}}
                            </button>
                            <button type="button" class="btn btn-primary" id="dropdown1" *ngIf="fonctionnaliteSelected.etat == 'En progrès'">
                                {{fonctionnaliteSelected.etat}}
                            </button>
                            <button type="button" class="btn btn-success" id="dropdown1" *ngIf="fonctionnaliteSelected.etat == 'Terminé'">
                                {{fonctionnaliteSelected.etat}}
                            </button>
                            <!-- <div id="collapseExample" mdbCollapse #basicCollapses="mdbCollapse" style="position: static;">
                                <div aria-labelledby="dropdown1" *ngIf="fonctionnaliteSelected.etat == 'à faire'">
                                    <button type="button" (click)="setFonctionnaliteToEnProgres(fonctionnaliteSelected)" class="btn btn-outline-primary" id="dropdown1" >
                                        En progrès
                                    </button><br>
                                    <button type="button" (click)="setFonctionnaliteToTermine(fonctionnaliteSelected)" class="btn btn-outline-success" id="dropdown1" >
                                        Termine
                                    </button>
                                </div>
                                <div aria-labelledby="dropdown1" *ngIf="fonctionnaliteSelected.etat == 'En progrès'">
                                    <button type="button" (click)="setFonctionnaliteToAFaire(fonctionnaliteSelected)" class="btn btn-outline-secondary" id="dropdown1" >
                                        A faire
                                    </button><br>
                                    <button type="button" (click)="setFonctionnaliteToTermine(fonctionnaliteSelected)" class="btn btn-outline-success" id="dropdown1" >
                                        Termine
                                    </button>
                                </div>
                                <div aria-labelledby="dropdown1" *ngIf="fonctionnaliteSelected.etat == 'Terminé'">
                                    <button type="button" (click)="setFonctionnaliteToAFaire(fonctionnaliteSelected)" class="btn btn-outline-secondary" id="dropdown1" >
                                        A faire
                                    </button><br>
                                    <button type="button" (click)="setFonctionnaliteToEnProgres(fonctionnaliteSelected)" class="btn btn-outline-primary" id="dropdown1" >
                                        En progrès
                                    </button>
                                </div>
                            </div> -->
                        </div><br><br>
                        <div>
                            <table class="table">
                                <thead>
                                    <tr>
                                      <th scope="col"><b>Détails</b></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <th scope="row">Créateur</th>
                                        <td>
                                            <img *ngIf="fonctionnaliteSelected.idCreateur.photo" src="assets/{{fonctionnaliteSelected.idCreateur.photo}}" 
                                            style="width: 45px; height: 45px" class="rounded-circle" title="{{fonctionnaliteSelected.idCreateur.username}}">
                                            <img *ngIf="!fonctionnaliteSelected.idCreateur.photo" src="assets/imageDefault.jpg" 
                                            style="width: 45px; height: 45px" class="rounded-circle" title="{{fonctionnaliteSelected.idCreateur.username}}">
                                        </td>
                                    </tr>
                                    <!-- <tr>
                                        <th scope="row">Responsable(s)</th>
                                        <td ngbDropdown>
                                            <ng-container *ngFor="let responsable of responsableFonctionnaliteSelected">
                                                <img *ngIf="responsable.idResponsable && responsable.idResponsable.photo" src="assets/{{responsable.idResponsable.photo}}" 
                                                style="width: 45px; height: 45px" class="rounded-circle" title="{{responsable.idResponsable.username}}">
                                                <img *ngIf="responsable.idResponsable && !responsable.idResponsable.photo" src="assets/imageDefault.jpg"
                                                style="width: 45px; height: 45px" class="rounded-circle" title="{{responsable.idResponsable.username}}">
                                            </ng-container>
                                            <img src="assets/addUser.png" style="width: 45px; height: 45px;cursor: pointer" class="rounded-circle" title="ajouter responsable" ngbDropdownToggle>
                                            <ul ngbDropdownMenu style="width: 250px;" class="dropdown-menu-end" aria-labelledby="navbarDropdownMenuLink">
                                                <span>Rechercher:</span>
                                                <input type="text" placeholder="Search.." name="search" [(ngModel)]="nomRecherche" (input)="getFonctionnaliteResponsableFiltered()" style="width: 120px;"><br>
                                                <span>Assigner à :</span>
                                                <li *ngFor="let user of responsableFonctionnaliteFiltered">                               
                                                    <a class="dropdown-item" style="cursor: pointer" [ngClass]="{ 'active': user.isResponsable }" (click)="assignFonctionnaliteResponsable(user)" (click)="onItemClick($event)">
                                                        <div *ngIf="user.photo">
                                                            <label style="float: left;"><img src="assets\{{user.photo}}" style="width: 30px;height: 30px;" class="rounded-circle"></label>
                                                        </div>
                                                        <div *ngIf="!user.photo">
                                                            <label style="float: left;"><img src="assets\imageDefault.jpg" style="width: 30px;height: 30px;" class="rounded-circle"></label>
                                                        </div>
                                                        &nbsp;{{user.username}}
                                                    </a>
                                                </li>
                                            </ul>
                                        </td>
                                    </tr> -->
                                    <!-- <tr>
                                        <th scope="row">Scrum master(s)</th>
                                        <td ngbDropdown>
                                            <ng-container *ngFor="let scrumMaster of scrumMastersFonctionnaliteSelected">
                                                <img *ngIf="scrumMaster.idScrumMaster && scrumMaster.idScrumMaster.photo" src="assets/{{scrumMaster.idScrumMaster.photo}}" 
                                                style="width: 45px; height: 45px" class="rounded-circle" title="{{scrumMaster.idScrumMaster.username}}">
                                                <img *ngIf="scrumMaster.idScrumMaster && !scrumMaster.idScrumMaster.photo" src="assets/imageDefault.jpg"
                                                style="width: 45px; height: 45px" class="rounded-circle" title="{{scrumMaster.idScrumMaster.username}}">
                                            </ng-container>
                                            <img src="assets/addUser.png" style="width: 45px; height: 45px;cursor: pointer" class="rounded-circle" title="ajouter responsable" ngbDropdownToggle>
                                            <ul ngbDropdownMenu style="width: 250px;" class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdownMenuLink">
                                                <span>Rechercher:</span>
                                                <input type="text" placeholder="Search.." name="search" [(ngModel)]="nomRecherche" (input)="getFonctionnaliteScrumMastersFiltered()" style="width: 120px;"><br>
                                                <span>Assigner à :</span>
                                                <li *ngFor="let user of scrumMastersFonctionnaliteFiltered">                               
                                                    <a class="dropdown-item" style="cursor: pointer" [ngClass]="{ 'active': user.isScrumMaster }" (click)="assignFonctionnaliteScrumMaster(user)" (click)="onItemClick($event)">
                                                        <div *ngIf="user.photo">
                                                            <label style="float: left;"><img src="assets\{{user.photo}}" style="width: 30px;height: 30px;" class="rounded-circle"></label>
                                                        </div>
                                                        <div *ngIf="!user.photo">
                                                            <label style="float: left;"><img src="assets\imageDefault.jpg" style="width: 30px;height: 30px;" class="rounded-circle"></label>
                                                        </div>
                                                        &nbsp;{{user.username}}
                                                    </a>
                                                </li>
                                            </ul>
                                        </td>
                                    </tr> -->
                                    <tr>
                                        <th scope="row">Développeur(s)</th>
                                        <td ngbDropdown>
                                            <ng-container *ngFor="let developpeur of developersFonctionnaliteSelected">
                                                <img *ngIf="developpeur.idDevellopers && developpeur.idDevellopers.photo" src="assets/{{developpeur.idDevellopers.photo}}" 
                                                style="width: 45px; height: 45px" class="rounded-circle" title="{{developpeur.idDevellopers.username}}">
                                                <img *ngIf="developpeur.idDevellopers && !developpeur.idDevellopers.photo" src="assets/imageDefault.jpg"
                                                style="width: 45px; height: 45px" class="rounded-circle" title="{{developpeur.idDevellopers.username}}">
                                            </ng-container>
                                            <img src="assets/addUser.png" style="width: 45px; height: 45px;cursor: pointer" class="rounded-circle" title="ajouter responsable" ngbDropdownToggle>
                                            <ul ngbDropdownMenu style="width: 250px;" class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdownMenuLink">
                                                <span>Rechercher:</span>
                                                <input type="text" placeholder="Search.." name="search" [(ngModel)]="nomRecherche" (input)="getFonctionnaliteDevellopersFiltered()" style="width: 120px;"><br>
                                                <span>Assigner à :</span>
                                                <li *ngFor="let user of developersFonctionnaliteFiltered">                               
                                                    <a class="dropdown-item" style="cursor: pointer" [ngClass]="{ 'active': user.isDevelopper }" (click)="assignFonctionnaliteDevellopers(user)" (click)="onItemClick($event)">
                                                        <div *ngIf="user.photo">
                                                            <label style="float: left;"><img src="assets\{{user.photo}}" style="width: 30px;height: 30px;" class="rounded-circle"></label>
                                                        </div>
                                                        <div *ngIf="!user.photo">
                                                            <label style="float: left;"><img src="assets\imageDefault.jpg" style="width: 30px;height: 30px;" class="rounded-circle"></label>
                                                        </div>
                                                        &nbsp;{{user.username}}
                                                    </a>
                                                </li>
                                            </ul>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th scope="row">Date de début</th>
                                        <td *ngIf="fonctionnaliteSelected.dateDebut"><i>{{fonctionnaliteSelected.dateDebut}}</i></td>
                                        <td *ngIf="!fonctionnaliteSelected.dateDebut">
                                            <input *ngIf="backlogSelected.dateDebut && backlogSelected.dateFin" min="{{backlogSelected.dateMin}}" max="{{backlogSelected.dateMax}}" 
                                            [(ngModel)] = "dateDebut" (change)="addDateDebutToFonctionnalite(fonctionnaliteSelected)" class="form-control form-control-sm" type="date" style="width: 70%;">
                                            <input *ngIf="(!backlogSelected.dateDebut || !backlogSelected.dateFin) && projetInWork.dateDebut && projetInWork.dateFin" min="{{projetInWork.dateDebut}}" max="{{projetInWork.dateFin}}" 
                                            [(ngModel)] = "dateDebut" (change)="addDateDebutToFonctionnalite(fonctionnaliteSelected)" class="form-control form-control-sm" type="date" style="width: 70%;">
                                            <input *ngIf="(!backlogSelected.dateDebut || !backlogSelected.dateFin) && (!projetInWork.dateDebut || !projetInWork.dateFin)" 
                                            [(ngModel)] = "dateDebut" (change)="addDateDebutToFonctionnalite(fonctionnaliteSelected)" class="form-control form-control-sm" type="date" style="width: 70%;">
                                        </td>
                                    </tr>
                                    <tr>
                                        <th scope="row">Date d'échéance</th>
                                        <td *ngIf="fonctionnaliteSelected.dateFin"><i>{{fonctionnaliteSelected.dateFin}}</i></td>
                                        <td *ngIf="!fonctionnaliteSelected.dateFin">
                                            <input *ngIf="backlogSelected.dateDebut && backlogSelected.dateFin" min="{{backlogSelected.dateMin}}" max="{{backlogSelected.dateMax}}" 
                                            [(ngModel)] = "dateFin" (change)="addDateFinToFonctionnalite(fonctionnaliteSelected)" class="form-control form-control-sm" type="date" style="width: 70%;">
                                            <input *ngIf="(!backlogSelected.dateDebut || !backlogSelected.dateFin) && projetInWork.dateDebut && projetInWork.dateFin" min="{{projetInWork.dateDebut}}" max="{{projetInWork.dateFin}}" 
                                            [(ngModel)] = "dateFin" (change)="addDateFinToFonctionnalite(fonctionnaliteSelected)" class="form-control form-control-sm" type="date" style="width: 70%;">
                                            <input *ngIf="(!backlogSelected.dateDebut || !backlogSelected.dateFin) && (!projetInWork.dateDebut || !projetInWork.dateFin)" 
                                            [(ngModel)] = "dateFin" (change)="addDateFinToFonctionnalite(fonctionnaliteSelected)" class="form-control form-control-sm" type="date" style="width: 70%;">
                                        </td>
                                    </tr>
                                    <tr>
                                        <th scope="row">Terminé le</th>
                                        <td *ngIf="fonctionnaliteSelected.termine"><i>{{fonctionnaliteSelected.termine}}</i></td>
                                        <td *ngIf="!fonctionnaliteSelected.termine"></td>
                                    </tr>
                                </tbody>
                            </table>
                            <button class="btn btn-outline-primary" (click)="openFonctionnaliteUpdate(updateFonctionnalite,fonctionnaliteSelected)">Mettre à jour</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>        
    </div>
    <div class="modal-footer">
        <button class="btn btn-danger float-end" (click)="deleteFonctionnalite(fonctionnaliteSelected)">Supprimer</button>
    </div>
</ng-template>

<ng-template #TacheDetail let-modal style="width: 1000px;">
    <div class="modal-header" style="background-color: #007bff;">
		<h4 class="modal-title" id="modal-basic-title" style="color: aliceblue;">Détails tâche</h4>
		<button style="background-color: antiquewhite;" type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
	</div>
    <div class="modal-body" *ngIf="tacheSelected">
        <div class="body">
            <div class="col-lg-12">
                <div class="row">
                    <div class="col-md-8" style="max-height: 661px; overflow: auto;" ngbDropdown>
                        <h4>{{tacheSelected.nom}}</h4>
                        <strong style="cursor: pointer">Description:</strong>
                        <p>{{tacheSelected.description}}</p>
                        <div class="js-upload-finished">
                            <div class="col">
                                <div  id="collapseExample"  style="position: static;">
                                    <strong>Commentaire</strong>
                                    <div class="col-md-12 h-100 p-2 bg-light border rounded-3">
                                        <div id="collapseExample" style="position: static;">
                                            <textarea style="width: 100%;" [(ngModel)]="newCommentaireTache.commentaire"></textarea>
                                            <a class="list-group-item list-group-item-info" style="cursor: pointer;" *ngIf="fileNameTache">
                                                {{fileNameTache}} (ajouter un commentaire et/ou clickez sur <b>commenter</b> pour uploader le fichier.)</a>
                                            <button type="button" class="btn btn-outline-primary border-0 btn-sm" 
                                                style="float: right;" (click)="fileInput.click()">Upload fichier
                                            </button>
                                            <form class="mx-1 mx-md-4" (ngSubmit)="commentaireWithFileTache(myGroup)" ngNativeValidate>          
                                                <div [formGroup]="myGroup" enctype="multipart/form-data">
                                                    <input type="file" #fileInput style="display: none" (change)="uploadFileCommentTache($event,myGroup)">
                                                    <button *ngIf="fileNameTache && newCommentaireTache.commentaire" style="float: right;" class="btn btn-success border-0 btn-sm">Commenter</button>
                                                    <button *ngIf="fileNameTache && !newCommentaireTache.commentaire" style="float: right;" class="btn btn-success border-0 btn-sm" disables>Commenter</button>
                                                </div>
                                            </form>
                                            &nbsp;
                                            <button *ngIf="!fileNameTache && newCommentaireTache.commentaire" type="button" (click)="commenterTache(tacheSelected)" class="btn btn-primary border-0 btn-sm" style="float: right;">Commenter</button>
                                            <button *ngIf="!fileNameTache && !newCommentaireTache.commentaire" type="button" class="btn btn-primary border-0 btn-sm" style="float: right;" disabled>Commenter</button>
                                            <div class="list-group list-group-light" style="width: 100%;" *ngIf="commentairesTache">
                                                <div class="list-group-item list-group-item-action" style="height: auto" *ngFor="let com of commentairesTache">
                                                    <div *ngIf="com.createur.photo">
                                                        <img
                                                            src="assets/{{com.createur.photo}}"
                                                            alt=""
                                                            style="width: 45px; height: 45px"
                                                            class="rounded-circle"
                                                        />&nbsp;
                                                    </div>
                                                    <div *ngIf="!com.createur.photo">
                                                        <img
                                                            src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQP7NjSjKYoQFApBGgMXfrAioIDBfleCIZWyA&usqp=CAU"
                                                            alt=""
                                                            style="width: 45px; height: 45px"
                                                            class="rounded-circle"
                                                        />&nbsp;
                                                    </div>
                                                    <div style="position: relative;">
                                                        <b style="position: absolute; top: -50px;left: 50px;">{{com.createur.username}}</b>
                                                        &nbsp;<i style="position: absolute; top: -25px;left: 50px;">{{com.temp}}</i><br><br>
                                                    </div>
                                                    <div *ngIf="com.file == true">
                                                        <p style="position: relative; top: -30px;"> 
                                                            <ng-container *ngIf="com.commentaire">{{com.commentaire}} <br></ng-container>
                                                            -> <button *ngIf="getCommentaireFile(com)" class="btn btn-link" (click)="onDownloadFileCommentaire(com)">{{getCommentaireFile(com)}}</button>
                                                        </p>
                                                        <!-- <p style="position: relative; top: -30px;"></p> -->
                                                        <p style="position: relative;"><button type="button" class="btn btn-link" (click)="deleteCommentaireTache(com.idCommentaire,tacheSelected)">Supprimer</button></p>
                                                    </div>
                                                    <div *ngIf="com.file == false">
                                                        <p style="position: relative; top: -35px;" *ngIf="com.updating == false">{{com.commentaire}}</p>
                                                        <div *ngIf="com.updating == true">
                                                            <textarea name="" id="" cols="60" rows="5" [(ngModel)]="com.commentaire"></textarea>
                                                        </div>
                                                        <p>
                                                            <button type="button" class="btn btn-link" (click)="updateCommentaireTache(com.idCommentaire,com,tacheSelected)">Modifier</button>
                                                            &nbsp;
                                                            <button type="button" class="btn btn-link" (click)="deleteCommentaireTache(com.idCommentaire,tacheSelected)">Supprimer</button>
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="d-inline-block">
                            <button type="button" class="btn btn-warning" id="dropdown1" *ngIf="tacheSelected.etat == 'à faire'">
                                {{tacheSelected.etat}}
                            </button>
                            <button type="button" class="btn btn-primary" id="dropdown1" *ngIf="tacheSelected.etat == 'En progrès'">
                                {{tacheSelected.etat}}
                            </button>
                            <button type="button" class="btn btn-success" id="dropdown1" *ngIf="tacheSelected.etat == 'Terminé'">
                                {{tacheSelected.etat}}
                            </button>
                            <!-- <div id="collapseExample" mdbCollapse #basicCollapses="mdbCollapse" style="position: static;">
                                <div aria-labelledby="dropdown1" *ngIf="tacheSelected.etat == 'à faire'">
                                    <button type="button" (click)="setTacheToEnProgres(tacheSelected)" class="btn btn-outline-primary" id="dropdown1" >
                                        En progrès
                                    </button><br>
                                    <button type="button" (click)="setTacheToTermine(tacheSelected)" class="btn btn-outline-success" id="dropdown1" >
                                        Terminé
                                    </button>
                                </div>
                                <div aria-labelledby="dropdown1" *ngIf="tacheSelected.etat == 'En progrès'">
                                    <button type="button" (click)="setTacheToAFaire(tacheSelected)" class="btn btn-outline-warning" id="dropdown1" >
                                        à faire
                                    </button><br>
                                    <button type="button" (click)="setTacheToTermine(tacheSelected)" class="btn btn-outline-success" id="dropdown1" >
                                        Terminé
                                    </button>
                                </div>
                                <div aria-labelledby="dropdown1" *ngIf="tacheSelected.etat == 'Terminé'">
                                    <button type="button" (click)="setTacheToAFaire(tacheSelected)" class="btn btn-outline-warning" id="dropdown1" >
                                        à faire
                                    </button><br>
                                    <button type="button" (click)="setTacheToTermine(tacheSelected)" class="btn btn-outline-success" id="dropdown1" >
                                        Terminé
                                    </button>
                                </div>
                            </div> -->
                            <br>
                            <p *ngIf="tacheSelected.fonctionnalite.backlog.etat == 'Valable'"
                            style="font-size: 20px; display: flex; align-items: center;">
                                <b style="flex: 1;">Avancée tâche:&nbsp;</b>
                                <select [(ngModel)]="selectedValue" (change)="setTacheAvance()" class="form-select" style="width: 100px">
                                  <option [ngValue]="0">0 %</option>
                                  <option [ngValue]="25">25 %</option>
                                  <option [ngValue]="50">50 %</option>
                                  <option [ngValue]="75">75 %</option>
                                  <option [ngValue]="100" style="color: green">100 %</option>
                                </select>
                            </p>
                            <p *ngIf="tacheSelected.fonctionnalite.backlog.etat != 'Valable' && tacheSelected.etat != 'Terminé'">
                                <b>Backlog pas encore validé</b>
                            </p>
                        </div><br><br>
                        <div>
                            <table class="table">
                                <thead>
                                    <tr>
                                      <th scope="col"><b>Détails</b></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <th scope="row">Créateur</th>
                                        <td>
                                            <img *ngIf="tacheSelected.idRapporteur.photo" src="assets/{{tacheSelected.idRapporteur.photo}}" 
                                            style="width: 45px; height: 45px" class="rounded-circle" title="{{tacheSelected.idRapporteur.username}}">
                                            <img *ngIf="!tacheSelected.idRapporteur.photo" src="assets/imageDefault.jpg" 
                                            style="width: 45px; height: 45px" class="rounded-circle" title="{{tacheSelected.idRapporteur.username}}">
                                        </td>
                                    </tr>
                                    <!-- <tr>
                                        <th scope="row">Responsable</th>
                                        <td ngbDropdown *ngIf="tache.idResponsable">
                                            <img *ngIf="tache.idResponsable.photo" src="assets/{{tache.idResponsable.photo}}" 
                                            style="width: 45px; height: 45px" class="rounded-circle">
                                            <img *ngIf="!tache.idResponsable.photo" src="assets/imageDefault.jpg" 
                                            style="width: 45px; height: 45px" class="rounded-circle">
                                            {{tache.idResponsable.username}}<br>
                                            <div class="d-flex justify-content-end">
                                                <button ngbDropdownToggle class="btn btn-link float-end" >Réassigner</button>
                                                <ul
                                                    ngbDropdownMenu
                                                    class="dropdown-menu dropdown-menu-end"
                                                    aria-labelledby="navbarDropdownMenuLink"
                                                    >
                                                    <li>
                                                        <span>Rechercher:</span>
                                                        <input type="text" placeholder="Search.." name="search" [(ngModel)]="nomRecherche" (input)="getUsersByUsername()" style="width: 120px;"><br>
                                                        <span>Assigner à :</span>
                                                        <div  *ngFor="let users of scrumMaster">
                                                        <a class="dropdown-item" style="cursor: pointer" (click)="assignResponsable(users)">
                                                            <div *ngIf="users.photo">
                                                            <div style="float: left;"><img src="assets\{{users.photo}}" style="width: 30px;height: 30px;" class="rounded-circle"></div>
                                                            </div>
                                                            <div *ngIf="!users.photo">
                                                            <div style="float: left;"><img src="assets\imageDefault.jpg" style="width: 30px;height: 30px;" class="rounded-circle"></div>
                                                            </div>
                                                            {{users.username}}
                                                        </a>
                                                        </div>
                                                        
                                                    </li>
                                                </ul>
                                            </div>
                                        </td>
                                        <td ngbDropdown *ngIf="!tache.idResponsable">
                                            <button ngbDropdownToggle class="btn btn-link">Assigner</button>
                                            <ul
                                                ngbDropdownMenu
                                                class="dropdown-menu dropdown-menu-end"
                                                aria-labelledby="navbarDropdownMenuLink"
                                                >
                                                <li>
                                                    <span>Rechercher:</span>
                                                    <input type="text" placeholder="Search.." name="search" [(ngModel)]="nomRecherche" (input)="getUsersByUsername()" style="width: 120px;"><br>
                                                    <span>Assigner à :</span>
                                                    <div  *ngFor="let users of scrumMaster">
                                                    <a class="dropdown-item" style="cursor: pointer" (click)="assignResponsable(users)">
                                                        <div *ngIf="users.photo">
                                                        <div style="float: left;"><img src="assets\{{users.photo}}" style="width: 30px;height: 30px;" class="rounded-circle"></div>
                                                        </div>
                                                        <div *ngIf="!users.photo">
                                                        <div style="float: left;"><img src="assets\imageDefault.jpg" style="width: 30px;height: 30px;" class="rounded-circle"></div>
                                                        </div>
                                                        {{users.username}}
                                                    </a>
                                                    </div>
                                                    
                                                </li>
                                            </ul>
                                        </td>
                                    </tr> -->
                                    <tr>
                                        <th scope="row">Date de début</th>
                                        <td *ngIf="tacheSelected.dateDebut"><i>{{tacheSelected.dateDebut}}</i></td>
                                        <td *ngIf="!tacheSelected.dateDebut">
                                            <!-- <button class="btn btn-link" *ngIf="!addDebutTache" (click)="addDebutTache = true">
                                                <i>Ajouter date debut</i>
                                            </button> -->
                                            <!-- <input [(ngModel)] = "dateDebut" (change)="addDateDebutToTache(tacheSelected)" 
                                            class="form-control form-control-sm" type="date" style="width: 70%;"> -->

                                            <input *ngIf="fonctionnaliteSelected.dateDebut && fonctionnaliteSelected.dateFin" min="{{fonctionnaliteSelected.dateMin}}" max="{{fonctionnaliteSelected.dateMax}}" 
                                            [(ngModel)] = "dateDebut" (change)="addDateDebutToTache(tacheSelected)" class="form-control form-control-sm" type="date" style="width: 70%;">
                                            <input *ngIf="(!fonctionnaliteSelected.dateDebut || !fonctionnaliteSelected.dateFin) && backlogSelected.dateDebut && backlogSelected.dateFin" min="{{backlogSelected.dateMin}}" max="{{backlogSelected.dateMax}}" 
                                            [(ngModel)] = "dateDebut" (change)="addDateDebutToTache(tacheSelected)" class="form-control form-control-sm" type="date" style="width: 70%;">
                                            <input *ngIf="(!fonctionnaliteSelected.dateDebut || !fonctionnaliteSelected.dateFin) && (!backlogSelected.dateDebut || !backlogSelected.dateFin) && projetInWork.dateDebut && projetInWork.dateFin" min="{{projetInWork.dateDebut}}" max="{{projetInWork.dateFin}}" 
                                            [(ngModel)] = "dateDebut" (change)="addDateDebutToTache(tacheSelected)" class="form-control form-control-sm" type="date" style="width: 70%;">
                                            <input *ngIf="(!fonctionnaliteSelected.dateDebut || !fonctionnaliteSelected.dateFin) && (!backlogSelected.dateDebut || !backlogSelected.dateFin) && (!projetInWork.dateDebut || !projetInWork.dateFin)" 
                                            [(ngModel)] = "dateDebut" (change)="addDateDebutToTache(tacheSelected)" class="form-control form-control-sm" type="date" style="width: 70%;">
                                        </td>
                                    </tr>
                                    <tr>
                                        <th scope="row">Date d'échéance</th>
                                        <td *ngIf="tacheSelected.dateFin"><i>{{tacheSelected.dateFin}}</i></td>
                                        <td *ngIf="!tacheSelected.dateFin">
                                            <!-- <button class="btn btn-link" *ngIf="!addFinTache" (click)="addFinTache = true">
                                                <i>Ajouter échéance</i>
                                            </button> -->
                                            <!-- <input [(ngModel)] = "dateFin" (change)="addDateFinToTache(tacheSelected)" 
                                            class="form-control form-control-sm" type="date" style="width: 70%;"> -->

                                            <input *ngIf="fonctionnaliteSelected.dateDebut && fonctionnaliteSelected.dateFin" min="{{fonctionnaliteSelected.dateMin}}" max="{{fonctionnaliteSelected.dateMax}}" 
                                            [(ngModel)] = "dateFin" (change)="addDateFinToTache(tacheSelected)" class="form-control form-control-sm" type="date" style="width: 70%;">
                                            <input *ngIf="(!fonctionnaliteSelected.dateDebut || !fonctionnaliteSelected.dateFin) && backlogSelected.dateDebut && backlogSelected.dateFin" min="{{backlogSelected.dateMin}}" max="{{backlogSelected.dateMax}}" 
                                            [(ngModel)] = "dateFin" (change)="addDateFinToTache(tacheSelected)" class="form-control form-control-sm" type="date" style="width: 70%;">
                                            <input *ngIf="(!fonctionnaliteSelected.dateDebut || !fonctionnaliteSelected.dateFin) && (!backlogSelected.dateDebut || !backlogSelected.dateFin) && projetInWork.dateDebut && projetInWork.dateFin" min="{{projetInWork.dateDebut}}" max="{{projetInWork.dateFin}}" 
                                            [(ngModel)] = "dateFin" (change)="addDateFinToTache(tacheSelected)" class="form-control form-control-sm" type="date" style="width: 70%;">
                                            <input *ngIf="(!fonctionnaliteSelected.dateDebut || !fonctionnaliteSelected.dateFin) && (!backlogSelected.dateDebut || !backlogSelected.dateFin) && (!projetInWork.dateDebut || !projetInWork.dateFin)" 
                                            [(ngModel)] = "dateFin" (change)="addDateFinToTache(tacheSelected)" class="form-control form-control-sm" type="date" style="width: 70%;">
                                        </td>
                                    </tr>
                                    <tr>
                                        <th scope="row">Terminé le</th>
                                        <td *ngIf="tacheSelected.termine"><i>{{tacheSelected.termine}}</i></td>
                                        <td *ngIf="!tacheSelected.termine"></td>
                                    </tr>
                                </tbody>
                            </table>
                            <button class="btn btn-outline-primary" (click)="openTacheUpdate(updateTache,tacheSelected)">Mettre à jour</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>        
    </div>
    <div class="modal-footer">
        <button class="btn btn-danger float-end" (click)="deleteTache(tacheSelected)">Supprimer</button>
    </div>
</ng-template>

<ng-template #updateBacklog let-modal>
    <div class="modal-header" style="background-color: #007bff;">
        <h4 class="modal-title" id="modal-basic-title" style="color: aliceblue;">Mis à jour de backlog</h4>
        <button style="background-color: antiquewhite;" type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
    </div>
    <div class="modal-body" *ngIf="backlogUpdate" ngbDropdown [autoClose]="false">
        <div class="row justify-content-center">
            <div class="col-md-10 col-lg-6 col-xl-5 order-2 order-lg-1">
                <form class="mx-1 mx-md-4">      
                    <div class="mb-3">
                        <label for="project-name" class="col-form-label">Nom du projet:</label>
                        <input type="text" [(ngModel)] = "backlogUpdate.nom" class="form-control" id="nom_projet" name="nom_projet"/>
                    </div>
                    <div class="mb-3">
                        <label for="description-text" class="col-form-label">Description:</label>
                        <textarea class="form-control" [(ngModel)] = "backlogUpdate.description" id="description" name="description"></textarea>
                    </div>
                    <!-- <div class="mb-3" ngbDropdown [autoClose]="false">
                        <button class="btn btn-outline-primary" ngbDropdownToggle>Responsable</button>
                        <ul ngbDropdownMenu class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdownMenuLink">
                            <span>Rechercher:</span>
                            <input type="text" placeholder="Search.." name="search" [(ngModel)]="nomRecherche" (input)="getResponsableFiltered()" style="width: 120px;"><br>
                            <span>Assigner à :</span>
                            <li *ngFor="let user of responsableFiltered">                               
                                <a class="dropdown-item" style="cursor: pointer" [ngClass]="{ 'active': user.isResponsable }" (click)="assignResponsable(user)" (click)="onItemClick($event)">
                                    <div *ngIf="user.photo">
                                        <label style="float: left;"><img src="assets\{{user.photo}}" style="width: 30px;height: 30px;" class="rounded-circle"></label>
                                    </div>
                                    <div *ngIf="!user.photo">
                                        <label style="float: left;"><img src="assets\imageDefault.jpg" style="width: 30px;height: 30px;" class="rounded-circle"></label>
                                    </div>
                                    &nbsp;{{user.username}}
                                </a>
                            </li>
                        </ul>
                    </div> -->
                    <!-- <div class="mb-3" ngbDropdown [autoClose]="false">
                        <button class="btn btn-outline-primary" ngbDropdownToggle>Scrum master</button>
                        <ul ngbDropdownMenu class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdownMenuLink">
                            <span>Rechercher:</span>
                            <input type="text" placeholder="Search.." name="search" [(ngModel)]="nomRecherche" (input)="getScrumMasterFiltered()" style="width: 120px;"><br>
                            <span>Assigner à :</span>
                            <li *ngFor="let user of scrumMasterFiltered">                               
                                <a class="dropdown-item" style="cursor: pointer" [ngClass]="{ 'active': user.isResponsable }" (click)="assignScrumMaster(user)" (click)="onItemClick($event)">
                                    <div *ngIf="user.photo">
                                        <label style="float: left;"><img src="assets\{{user.photo}}" style="width: 30px;height: 30px;" class="rounded-circle"></label>
                                    </div>
                                    <div *ngIf="!user.photo">
                                        <label style="float: left;"><img src="assets\imageDefault.jpg" style="width: 30px;height: 30px;" class="rounded-circle"></label>
                                    </div>
                                    &nbsp;{{user.username}}
                                </a>
                            </li>
                        </ul>
                    </div>
                    <div class="mb-3" ngbDropdown [autoClose]="false">
                        <button class="btn btn-outline-primary" ngbDropdownToggle>Product owner</button>
                        <ul ngbDropdownMenu class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdownMenuLink">
                            <span>Rechercher:</span>
                            <input type="text" placeholder="Search.." name="search" [(ngModel)]="nomRecherche" (input)="getProductOwnerFiltered()" style="width: 120px;"><br>
                            <span>Assigner à :</span>
                            <li *ngFor="let user of productOwnerFiltered">                               
                                <a class="dropdown-item" style="cursor: pointer" [ngClass]="{ 'active': user.isResponsable }" (click)="assignProductOwner(user)" (click)="onItemClick($event)">
                                    <div *ngIf="user.photo">
                                        <label style="float: left;"><img src="assets\{{user.photo}}" style="width: 30px;height: 30px;" class="rounded-circle"></label>
                                    </div>
                                    <div *ngIf="!user.photo">
                                        <label style="float: left;"><img src="assets\imageDefault.jpg" style="width: 30px;height: 30px;" class="rounded-circle"></label>
                                    </div>
                                    &nbsp;{{user.username}}
                                </a>
                            </li>
                        </ul>
                    </div> -->
                    <div class="mb-3">
                        <label>Date de début:</label>
                        <input *ngIf="!projetInWork.dateDebut || !projetInWork.dateFin" type="date" [(ngModel)] = "backlogUpdate.dateDebut"  class="form-control" [ngModelOptions]="{standalone: true}">
                        <input *ngIf="projetInWork.dateDebut && projetInWork.dateFin" [(ngModel)] = "backlogUpdate.dateDebut" min="{{projetInWork.dateDebut}}" 
                        max="{{projetInWork.dateFin}}" class="form-control form-control-sm" type="date" [ngModelOptions]="{standalone: true}">
                    </div>
                    <div class="mb-3">
                        <label>Date d'échéance:</label>
                        <input *ngIf="!projetInWork.dateDebut || !projetInWork.dateFin" type="date" [(ngModel)] = "backlogUpdate.dateFin" class="form-control" [ngModelOptions]="{standalone: true}">
                        <input *ngIf="projetInWork.dateDebut && projetInWork.dateFin" [(ngModel)] = "backlogUpdate.dateFin" min="{{projetInWork.dateDebut}}" 
                        max="{{projetInWork.dateFin}}" class="form-control form-control-sm" type="date" [ngModelOptions]="{standalone: true}">
                    </div>
                    <div class="modal-footer">
                        <button type="submit" (click)="updateBacklogSelected(backlogUpdate)" class="btn btn-outline-success">Update</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</ng-template>

<ng-template #updateFonctionnalite let-modal>
    <div class="modal-header" style="background-color: #007bff;">
        <h4 class="modal-title" id="modal-basic-title" style="color: aliceblue;">Mis à jour de Module</h4>
        <button style="background-color: antiquewhite;" type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
    </div>
    <div class="modal-body" *ngIf="fonctionnaliteUpdate" ngbDropdown [autoClose]="false">
        <div class="row justify-content-center">
            <div class="col-md-10 col-lg-6 col-xl-5 order-2 order-lg-1">
                <form class="mx-1 mx-md-4">      
                    <div class="mb-3">
                        <label for="project-name" class="col-form-label">Nom du projet:</label>
                        <input type="text" [(ngModel)] = "fonctionnaliteUpdate.nom" class="form-control" id="nom_projet" name="nom_projet"/>
                    </div>
                    <div class="mb-3">
                        <label for="description-text" class="col-form-label">Description:</label>
                        <textarea class="form-control" [(ngModel)] = "fonctionnaliteUpdate.description" id="description" name="description"></textarea>
                    </div>
                    <!-- <div class="mb-3" ngbDropdown [autoClose]="false">
                        <button class="btn btn-outline-primary" ngbDropdownToggle>Responsable</button>
                        <ul ngbDropdownMenu class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdownMenuLink">
                            <span>Rechercher:</span>
                            <input type="text" placeholder="Search.." name="search" [(ngModel)]="nomRecherche" (input)="getResponsableFiltered()" style="width: 120px;"><br>
                            <span>Assigner à :</span>
                            <li *ngFor="let user of responsableFiltered">                               
                                <a class="dropdown-item" style="cursor: pointer" [ngClass]="{ 'active': user.isResponsable }" (click)="assignResponsable(user)" (click)="onItemClick($event)">
                                    <div *ngIf="user.photo">
                                        <label style="float: left;"><img src="assets\{{user.photo}}" style="width: 30px;height: 30px;" class="rounded-circle"></label>
                                    </div>
                                    <div *ngIf="!user.photo">
                                        <label style="float: left;"><img src="assets\imageDefault.jpg" style="width: 30px;height: 30px;" class="rounded-circle"></label>
                                    </div>
                                    &nbsp;{{user.username}}
                                </a>
                            </li>
                        </ul>
                    </div> -->
                    <!-- <div class="mb-3" ngbDropdown [autoClose]="false">
                        <button class="btn btn-outline-primary" ngbDropdownToggle>Scrum master</button>
                        <ul ngbDropdownMenu class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdownMenuLink">
                            <span>Rechercher:</span>
                            <input type="text" placeholder="Search.." name="search" [(ngModel)]="nomRecherche" (input)="getScrumMasterFiltered()" style="width: 120px;"><br>
                            <span>Assigner à :</span>
                            <li *ngFor="let user of scrumMasterFiltered">                               
                                <a class="dropdown-item" style="cursor: pointer" [ngClass]="{ 'active': user.isResponsable }" (click)="assignScrumMaster(user)" (click)="onItemClick($event)">
                                    <div *ngIf="user.photo">
                                        <label style="float: left;"><img src="assets\{{user.photo}}" style="width: 30px;height: 30px;" class="rounded-circle"></label>
                                    </div>
                                    <div *ngIf="!user.photo">
                                        <label style="float: left;"><img src="assets\imageDefault.jpg" style="width: 30px;height: 30px;" class="rounded-circle"></label>
                                    </div>
                                    &nbsp;{{user.username}}
                                </a>
                            </li>
                        </ul>
                    </div>
                    <div class="mb-3" ngbDropdown [autoClose]="false">
                        <button class="btn btn-outline-primary" ngbDropdownToggle>Product owner</button>
                        <ul ngbDropdownMenu class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdownMenuLink">
                            <span>Rechercher:</span>
                            <input type="text" placeholder="Search.." name="search" [(ngModel)]="nomRecherche" (input)="getProductOwnerFiltered()" style="width: 120px;"><br>
                            <span>Assigner à :</span>
                            <li *ngFor="let user of productOwnerFiltered">                               
                                <a class="dropdown-item" style="cursor: pointer" [ngClass]="{ 'active': user.isResponsable }" (click)="assignProductOwner(user)" (click)="onItemClick($event)">
                                    <div *ngIf="user.photo">
                                        <label style="float: left;"><img src="assets\{{user.photo}}" style="width: 30px;height: 30px;" class="rounded-circle"></label>
                                    </div>
                                    <div *ngIf="!user.photo">
                                        <label style="float: left;"><img src="assets\imageDefault.jpg" style="width: 30px;height: 30px;" class="rounded-circle"></label>
                                    </div>
                                    &nbsp;{{user.username}}
                                </a>
                            </li>
                        </ul>
                    </div> -->
                    <div class="mb-3">
                        <label>Date de début:</label>
                        <input *ngIf="fonctionnaliteUpdate.dateDebut && backlogSelected.dateDebut && backlogSelected.dateFin" min="{{backlogSelected.dateMin}}" max="{{backlogSelected.dateMax}}" 
                        [(ngModel)] = "fonctionnaliteUpdate.dateDebut" class="form-control form-control-sm" type="date" [ngModelOptions]="{standalone: true}">
                        <input *ngIf="fonctionnaliteUpdate.dateDebut && (!backlogSelected.dateDebut || !backlogSelected.dateFin) && projetInWork.dateDebut && projetInWork.dateFin" min="{{projetInWork.dateDebut}}" max="{{projetInWork.dateFin}}" 
                        [(ngModel)] = "fonctionnaliteUpdate.dateDebut" class="form-control form-control-sm" type="date" [ngModelOptions]="{standalone: true}">
                        <input *ngIf="fonctionnaliteUpdate.dateDebut && (!backlogSelected.dateDebut || !backlogSelected.dateFin) && (!projetInWork.dateDebut || !projetInWork.dateFin)" 
                        [(ngModel)] = "fonctionnaliteUpdate.dateDebut" class="form-control form-control-sm" type="date" [ngModelOptions]="{standalone: true}">
                        <input *ngIf="!fonctionnaliteUpdate.dateDebut && backlogSelected.dateDebut && backlogSelected.dateFin" min="{{backlogSelected.dateMin}}" max="{{backlogSelected.dateMax}}" 
                        [(ngModel)] = "fonctionnaliteUpdate.dateDebut" class="form-control form-control-sm" type="date" [ngModelOptions]="{standalone: true}">
                        <input *ngIf="!fonctionnaliteUpdate.dateDebut && (!backlogSelected.dateDebut || !backlogSelected.dateFin) && projetInWork.dateDebut && projetInWork.dateFin" min="{{projetInWork.dateDebut}}" max="{{projetInWork.dateFin}}" 
                        [(ngModel)] = "fonctionnaliteUpdate.dateDebut" class="form-control form-control-sm" type="date" [ngModelOptions]="{standalone: true}">
                        <input *ngIf="!fonctionnaliteUpdate.dateDebut && (!backlogSelected.dateDebut || !backlogSelected.dateFin) && (!projetInWork.dateDebut || !projetInWork.dateFin)" 
                        [(ngModel)] = "fonctionnaliteUpdate.dateDebut" class="form-control form-control-sm" type="date" [ngModelOptions]="{standalone: true}">
                    </div>
                    <div class="mb-3">
                        <label>Date d'échéance:</label>
                        <input *ngIf="fonctionnaliteUpdate.dateFin && backlogSelected.dateDebut && backlogSelected.dateFin" min="{{backlogSelected.dateMin}}" max="{{backlogSelected.dateMax}}" 
                        [(ngModel)] = "fonctionnaliteUpdate.dateFin" class="form-control form-control-sm" type="date" [ngModelOptions]="{standalone: true}">
                        <input *ngIf="fonctionnaliteUpdate.dateFin && (!backlogSelected.dateDebut || !backlogSelected.dateFin) && projetInWork.dateDebut && projetInWork.dateFin" min="{{projetInWork.dateDebut}}" max="{{projetInWork.dateFin}}" 
                        [(ngModel)] = "fonctionnaliteUpdate.dateFin" class="form-control form-control-sm" type="date" [ngModelOptions]="{standalone: true}">
                        <input *ngIf="fonctionnaliteUpdate.dateFin && (!backlogSelected.dateDebut || !backlogSelected.dateFin) && (!projetInWork.dateDebut || !projetInWork.dateFin)" 
                        [(ngModel)] = "fonctionnaliteUpdate.dateFin" class="form-control form-control-sm" type="date" [ngModelOptions]="{standalone: true}">
                        <input *ngIf="!fonctionnaliteUpdate.dateFin && backlogSelected.dateDebut && backlogSelected.dateFin" min="{{backlogSelected.dateMin}}" max="{{backlogSelected.dateMax}}" 
                        [(ngModel)] = "fonctionnaliteUpdate.dateFin" class="form-control form-control-sm" type="date" [ngModelOptions]="{standalone: true}">
                        <input *ngIf="!fonctionnaliteUpdate.dateFin && (!backlogSelected.dateDebut || !backlogSelected.dateFin) && projetInWork.dateDebut && projetInWork.dateFin" min="{{projetInWork.dateDebut}}" max="{{projetInWork.dateFin}}" 
                        [(ngModel)] = "fonctionnaliteUpdate.dateFin" class="form-control form-control-sm" type="date" [ngModelOptions]="{standalone: true}">
                        <input *ngIf="!fonctionnaliteUpdate.dateFin && (!backlogSelected.dateDebut || !backlogSelected.dateFin) && (!projetInWork.dateDebut || !projetInWork.dateFin)" 
                        [(ngModel)] = "fonctionnaliteUpdate.dateFin" class="form-control form-control-sm" type="date" [ngModelOptions]="{standalone: true}">
                    </div>
                    <!-- <tr>
                        <th scope="row">Date de début</th>
                        <td *ngIf="fonctionnaliteSelected.dateDebut"><i>{{fonctionnaliteSelected.dateDebut}}</i></td>
                        <td *ngIf="!fonctionnaliteSelected.dateDebut">
                            <input *ngIf="backlogSelected.dateDebut && backlogSelected.dateFin" min="{{backlogSelected.dateMin}}" max="{{backlogSelected.dateMax}}" 
                            [(ngModel)] = "dateDebut" (change)="addDateDebutToFonctionnalite(fonctionnaliteSelected)" class="form-control form-control-sm" type="date" style="width: 70%;">
                            <input *ngIf="(!backlogSelected.dateDebut || !backlogSelected.dateFin) && projetInWork.dateDebut && projetInWork.dateFin" min="{{projetInWork.dateDebut}}" max="{{projetInWork.dateFin}}" 
                            [(ngModel)] = "dateDebut" (change)="addDateDebutToFonctionnalite(fonctionnaliteSelected)" class="form-control form-control-sm" type="date" style="width: 70%;">
                            <input *ngIf="(!backlogSelected.dateDebut || !backlogSelected.dateFin) && (!projetInWork.dateDebut || !projetInWork.dateFin)" 
                            [(ngModel)] = "dateDebut" (change)="addDateDebutToFonctionnalite(fonctionnaliteSelected)" class="form-control form-control-sm" type="date" style="width: 70%;">
                        </td>
                    </tr>
                    <tr>
                        <th scope="row">Date d'échéance</th>
                        <td *ngIf="fonctionnaliteSelected.dateFin"><i>{{fonctionnaliteSelected.dateFin}}</i></td>
                        <td *ngIf="!fonctionnaliteSelected.dateFin">
                            <input *ngIf="backlogSelected.dateDebut && backlogSelected.dateFin" min="{{backlogSelected.dateMin}}" max="{{backlogSelected.dateMax}}" 
                            [(ngModel)] = "dateFin" (change)="addDateFinToFonctionnalite(fonctionnaliteSelected)" class="form-control form-control-sm" type="date" style="width: 70%;">
                            <input *ngIf="(!backlogSelected.dateDebut || !backlogSelected.dateFin) && projetInWork.dateDebut && projetInWork.dateFin" min="{{projetInWork.dateDebut}}" max="{{projetInWork.dateFin}}" 
                            [(ngModel)] = "dateFin" (change)="addDateFinToFonctionnalite(fonctionnaliteSelected)" class="form-control form-control-sm" type="date" style="width: 70%;">
                            <input *ngIf="(!backlogSelected.dateDebut || !backlogSelected.dateFin) && (!projetInWork.dateDebut || !projetInWork.dateFin)" 
                            [(ngModel)] = "dateFin" (change)="addDateFinToFonctionnalite(fonctionnaliteSelected)" class="form-control form-control-sm" type="date" style="width: 70%;">
                        </td>
                    </tr> -->
                    <!-- <div class="mb-3">
                        <label>Date de début:</label>
                        <input type="date" [(ngModel)] = "fonctionnaliteUpdate.dateDebut"  class="form-control" [ngModelOptions]="{standalone: true}">
                    </div>
                    <div class="mb-3">
                        <label>Date d'échéance:</label>
                        <input type="date" [(ngModel)] = "fonctionnaliteUpdate.dateFin" class="form-control" [ngModelOptions]="{standalone: true}">
                    </div> -->
                    <div class="modal-footer">
                        <button type="submit" (click)="updateFonctionnaliteSelected(fonctionnaliteUpdate)" class="btn btn-outline-success">Update</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</ng-template>

<ng-template #updateTache let-modal>
    <div class="modal-header" style="background-color: #007bff;">
        <h4 class="modal-title" id="modal-basic-title" style="color: aliceblue;">Mis à jour de tache</h4>
        <button style="background-color: antiquewhite;" type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
    </div>
    <div class="modal-body" *ngIf="tacheUpdate" ngbDropdown [autoClose]="false">
        <div class="row justify-content-center">
            <div class="col-md-10 col-lg-6 col-xl-5 order-2 order-lg-1">
                <form class="mx-1 mx-md-4">      
                    <div class="mb-3">
                        <label for="project-name" class="col-form-label">Nom du projet:</label>
                        <input type="text" [(ngModel)] = "tacheUpdate.nom" class="form-control" id="nom_projet" name="nom_projet"/>
                    </div>
                    <div class="mb-3">
                        <label for="description-text" class="col-form-label">Description:</label>
                        <textarea class="form-control" [(ngModel)] = "tacheUpdate.description" id="description" name="description"></textarea>
                    </div>
                    <!-- <div class="mb-3" ngbDropdown [autoClose]="false">
                        <button class="btn btn-outline-primary" ngbDropdownToggle>Responsable</button>
                        <ul ngbDropdownMenu class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdownMenuLink">
                            <span>Rechercher:</span>
                            <input type="text" placeholder="Search.." name="search" [(ngModel)]="nomRecherche" (input)="getResponsableFiltered()" style="width: 120px;"><br>
                            <span>Assigner à :</span>
                            <li *ngFor="let user of responsableFiltered">                               
                                <a class="dropdown-item" style="cursor: pointer" [ngClass]="{ 'active': user.isResponsable }" (click)="assignResponsable(user)" (click)="onItemClick($event)">
                                    <div *ngIf="user.photo">
                                        <label style="float: left;"><img src="assets\{{user.photo}}" style="width: 30px;height: 30px;" class="rounded-circle"></label>
                                    </div>
                                    <div *ngIf="!user.photo">
                                        <label style="float: left;"><img src="assets\imageDefault.jpg" style="width: 30px;height: 30px;" class="rounded-circle"></label>
                                    </div>
                                    &nbsp;{{user.username}}
                                </a>
                            </li>
                        </ul>
                    </div> -->
                    <!-- <div class="mb-3" ngbDropdown [autoClose]="false">
                        <button class="btn btn-outline-primary" ngbDropdownToggle>Scrum master</button>
                        <ul ngbDropdownMenu class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdownMenuLink">
                            <span>Rechercher:</span>
                            <input type="text" placeholder="Search.." name="search" [(ngModel)]="nomRecherche" (input)="getScrumMasterFiltered()" style="width: 120px;"><br>
                            <span>Assigner à :</span>
                            <li *ngFor="let user of scrumMasterFiltered">                               
                                <a class="dropdown-item" style="cursor: pointer" [ngClass]="{ 'active': user.isResponsable }" (click)="assignScrumMaster(user)" (click)="onItemClick($event)">
                                    <div *ngIf="user.photo">
                                        <label style="float: left;"><img src="assets\{{user.photo}}" style="width: 30px;height: 30px;" class="rounded-circle"></label>
                                    </div>
                                    <div *ngIf="!user.photo">
                                        <label style="float: left;"><img src="assets\imageDefault.jpg" style="width: 30px;height: 30px;" class="rounded-circle"></label>
                                    </div>
                                    &nbsp;{{user.username}}
                                </a>
                            </li>
                        </ul>
                    </div>
                    <div class="mb-3" ngbDropdown [autoClose]="false">
                        <button class="btn btn-outline-primary" ngbDropdownToggle>Product owner</button>
                        <ul ngbDropdownMenu class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdownMenuLink">
                            <span>Rechercher:</span>
                            <input type="text" placeholder="Search.." name="search" [(ngModel)]="nomRecherche" (input)="getProductOwnerFiltered()" style="width: 120px;"><br>
                            <span>Assigner à :</span>
                            <li *ngFor="let user of productOwnerFiltered">                               
                                <a class="dropdown-item" style="cursor: pointer" [ngClass]="{ 'active': user.isResponsable }" (click)="assignProductOwner(user)" (click)="onItemClick($event)">
                                    <div *ngIf="user.photo">
                                        <label style="float: left;"><img src="assets\{{user.photo}}" style="width: 30px;height: 30px;" class="rounded-circle"></label>
                                    </div>
                                    <div *ngIf="!user.photo">
                                        <label style="float: left;"><img src="assets\imageDefault.jpg" style="width: 30px;height: 30px;" class="rounded-circle"></label>
                                    </div>
                                    &nbsp;{{user.username}}
                                </a>
                            </li>
                        </ul>
                    </div> -->
                    <div class="mb-3">
                        <label>Date de début:</label>
                        <input *ngIf="tacheUpdate.dateDebut && (!fonctionnaliteSelected.dateDebut || !fonctionnaliteSelected.dateFin) && (!backlogSelected.dateDebut || !backlogSelected.dateFin) && (!projetInWork.dateDebut || !projetInWork.dateFin)" 
                        [(ngModel)] = "tacheUpdate.dateDebut" class="form-control form-control-sm" type="date" [ngModelOptions]="{standalone: true}">
                        <input *ngIf="tacheUpdate.dateDebut && (!fonctionnaliteSelected.dateDebut || !fonctionnaliteSelected.dateFin) && (!backlogSelected.dateDebut || !backlogSelected.dateFin) && projetInWork.dateDebut && projetInWork.dateFin" min="{{projetInWork.dateDebut}}" max="{{projetInWork.dateFin}}" 
                        [(ngModel)] = "tacheUpdate.dateDebut" class="form-control form-control-sm" type="date" [ngModelOptions]="{standalone: true}">
                        <input *ngIf="tacheUpdate.dateDebut && (!fonctionnaliteSelected.dateDebut || !fonctionnaliteSelected.dateFin) && backlogSelected.dateDebut && backlogSelected.dateFin" min="{{backlogSelected.dateMin}}" max="{{backlogSelected.dateMax}}" 
                        [(ngModel)] = "tacheUpdate.dateDebut" class="form-control form-control-sm" type="date" [ngModelOptions]="{standalone: true}">
                        <input *ngIf="tacheUpdate.dateDebut && fonctionnaliteSelected.dateDebut && fonctionnaliteSelected.dateFin" min="{{fonctionnaliteSelected.dateMin}}" max="{{fonctionnaliteSelected.dateMax}}" 
                        [(ngModel)] = "tacheUpdate.dateDebut" class="form-control form-control-sm" type="date" [ngModelOptions]="{standalone: true}">
                        
                        <input *ngIf="!tacheUpdate.dateDebut && fonctionnaliteSelected.dateDebut && fonctionnaliteSelected.dateFin" min="{{fonctionnaliteSelected.dateMin}}" max="{{fonctionnaliteSelected.dateMax}}" 
                        [(ngModel)] = "tacheUpdate.dateDebut" class="form-control form-control-sm" type="date" [ngModelOptions]="{standalone: true}">
                        <input *ngIf="!tacheUpdate.dateDebut && (!fonctionnaliteSelected.dateDebut || !fonctionnaliteSelected.dateFin) && backlogSelected.dateDebut && backlogSelected.dateFin" min="{{backlogSelected.dateMin}}" max="{{backlogSelected.dateMax}}" 
                        [(ngModel)] = "tacheUpdate.dateDebut" class="form-control form-control-sm" type="date" [ngModelOptions]="{standalone: true}">
                        <input *ngIf="!tacheUpdate.dateDebut && (!fonctionnaliteSelected.dateDebut || !fonctionnaliteSelected.dateFin) && (!backlogSelected.dateDebut || !backlogSelected.dateFin) && projetInWork.dateDebut && projetInWork.dateFin" min="{{projetInWork.dateDebut}}" max="{{projetInWork.dateFin}}" 
                        [(ngModel)] = "tacheUpdate.dateDebut" class="form-control form-control-sm" type="date" [ngModelOptions]="{standalone: true}">
                        <input *ngIf="!tacheUpdate.dateDebut && (!fonctionnaliteSelected.dateDebut || !fonctionnaliteSelected.dateFin) && (!backlogSelected.dateDebut || !backlogSelected.dateFin) && (!projetInWork.dateDebut || !projetInWork.dateFin)" 
                        [(ngModel)] = "tacheUpdate.dateDebut" class="form-control form-control-sm" type="date" [ngModelOptions]="{standalone: true}">
                    </div>
                    <div class="mb-3">
                        <label>Date d'échéance:</label>
                        <input *ngIf="tacheUpdate.dateFin && (!fonctionnaliteSelected.dateDebut || !fonctionnaliteSelected.dateFin) && (!backlogSelected.dateDebut || !backlogSelected.dateFin) && (!projetInWork.dateDebut || !projetInWork.dateFin)" type="date" [(ngModel)] = "tacheUpdate.dateFin"  class="form-control" [ngModelOptions]="{standalone: true}">
                        <input *ngIf="tacheUpdate.dateFin && (!fonctionnaliteSelected.dateDebut || !fonctionnaliteSelected.dateFin) && (!backlogSelected.dateDebut || !backlogSelected.dateFin) && projetInWork.dateDebut && projetInWork.dateFin" min="{{projetInWork.dateDebut}}" max="{{projetInWork.dateFin}}" 
                        [(ngModel)] = "tacheUpdate.dateFin" class="form-control form-control-sm" type="date" [ngModelOptions]="{standalone: true}">
                        <input *ngIf="tacheUpdate.dateFin && (!fonctionnaliteSelected.dateDebut || !fonctionnaliteSelected.dateFin) && backlogSelected.dateDebut && backlogSelected.dateFin" min="{{backlogSelected.dateMin}}" max="{{backlogSelected.dateMax}}" 
                        [(ngModel)] = "tacheUpdate.dateFin" class="form-control form-control-sm" type="date" [ngModelOptions]="{standalone: true}">
                        <input *ngIf="tacheUpdate.dateFin && fonctionnaliteSelected.dateDebut && fonctionnaliteSelected.dateFin" min="{{fonctionnaliteSelected.dateMin}}" max="{{fonctionnaliteSelected.dateMax}}" 
                        [(ngModel)] = "tacheUpdate.dateFin" class="form-control form-control-sm" type="date" [ngModelOptions]="{standalone: true}">
                        
                        <input *ngIf="!tacheUpdate.dateFin && fonctionnaliteSelected.dateDebut && fonctionnaliteSelected.dateFin" min="{{fonctionnaliteSelected.dateMin}}" max="{{fonctionnaliteSelected.dateMax}}" 
                        [(ngModel)] = "tacheUpdate.dateFin" class="form-control form-control-sm" type="date" [ngModelOptions]="{standalone: true}">
                        <input *ngIf="!tacheUpdate.dateFin && (!fonctionnaliteSelected.dateDebut || !fonctionnaliteSelected.dateFin) && backlogSelected.dateDebut && backlogSelected.dateFin" min="{{backlogSelected.dateMin}}" max="{{backlogSelected.dateMax}}" 
                        [(ngModel)] = "tacheUpdate.dateFin" class="form-control form-control-sm" type="date" [ngModelOptions]="{standalone: true}">
                        <input *ngIf="!tacheUpdate.dateFin && (!fonctionnaliteSelected.dateDebut || !fonctionnaliteSelected.dateFin) && (!backlogSelected.dateDebut || !backlogSelected.dateFin) && projetInWork.dateDebut && projetInWork.dateFin" min="{{projetInWork.dateDebut}}" max="{{projetInWork.dateFin}}" 
                        [(ngModel)] = "tacheUpdate.dateFin" class="form-control form-control-sm" type="date" [ngModelOptions]="{standalone: true}">
                        <input *ngIf="!tacheUpdate.dateFin && (!fonctionnaliteSelected.dateDebut || !fonctionnaliteSelected.dateFin) && (!backlogSelected.dateDebut || !backlogSelected.dateFin) && (!projetInWork.dateDebut || !projetInWork.dateFin)" 
                        [(ngModel)] = "tacheUpdate.dateFin" class="form-control form-control-sm" type="date" [ngModelOptions]="{standalone: true}">
                    </div>
                    <div class="modal-footer">
                        <button type="submit" (click)="updateTacheSelected(tacheUpdate)" class="btn btn-outline-success">Update</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</ng-template>

<ng-template #SprintDetail let-modal>
    <div class="modal-header" style="background-color: #007bff;">
		<h4 class="modal-title" id="modal-basic-title" style="color: aliceblue;">Détails sprint</h4>
		<button style="background-color: antiquewhite;" type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
	</div>
    <div class="modal-body" *ngIf="sprintSelected">
        <div class="body">
            <div class="col-lg-12">
                <h4>{{sprintSelected.nom}}</h4>
                <strong>Sprint goal</strong>
                <p *ngIf="sprintSelected.objectif">{{sprintSelected.objectif}}</p>
                <p *ngIf="!sprintSelected.objectif"> </p>
                <strong>Date de début: </strong>
                <p *ngIf="sprintSelected.date_debut">{{sprintSelected.date_debut}}</p>
                <p *ngIf="!sprintSelected.date_debut">Non défini</p>
                <strong>Date d'échéance: </strong>
                <p *ngIf="sprintSelected.date_fin">{{sprintSelected.date_fin}}</p>
                <p *ngIf="!sprintSelected.date_fin">Non défini</p>
                <strong>Terminé le: </strong>
                <p *ngIf="sprintSelected.termine">{{sprintSelected.termine}}</p>
                <p *ngIf="!sprintSelected.termine">En attente</p>
            </div>
        </div>
    </div>            
</ng-template>

<ng-template #storypoint let-modal>
    <div class="modal-header" style="background-color: #007bff;">
		<h4 class="modal-title" id="modal-basic-title" style="color: aliceblue;">Date proposition</h4>
		<button style="background-color: antiquewhite;" type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
	</div>
    <div class="modal-body" *ngIf="backlogSelected">
        <div class="body">
            <div class="col-lg-12">
                <h4>L'ordinateur propose ces dates si vous les validez?</h4>
                <strong>{{backlogSelected.nom}}</strong>
                <p>Story point = {{backlogSelected.storyPoint}}</p>
                <strong>Date de début: </strong>
                <p *ngIf="backDateDebut">{{backDateDebut}}</p>
                <strong>Date d'échéance: </strong>
                <p *ngIf="backDateFin">{{backDateFin}}</p>
                <p></p>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button class="btn btn-success" (click)="proposition(true)">Accepter</button>
        <button class="btn btn-danger" (click)="proposition(false)">Refuser</button>
    </div>    
</ng-template>

<div *ngIf="isLogged">
    <p *ngIf="!idProjet">Aucun projet choisi</p>
    <div *ngIf="idProjet && projetInWork">
        <button class="btn btn-outline-primary" *ngIf="isProductOwner() || isAdmin()" (click)="open(myModal)">Changer de projet</button>
        <h3>Backlog</h3>
        <button class="btn btn-link" (click)="voirProjetDetail(projetInWork.idProjet)"><h5>{{projetInWork.nom}}</h5></button>    
        <div class="col-lg-12">
            <div class="row" cdkDropListGroup>
                <div class="col-md-6">
                    <div class="card mb-4 mb-md-0">
                        <div ngbDropdown>
                            <p style="margin-left: 20px;margin-top: 10px;float: left" class="mb-4"><b><u>Backlogs</u></b></p>
                            <button ngbDropdownToggle style="float: right" class="btn btn-md btn-outline-primary mt-2"><i class="fa fa-sort" aria-hidden="true"></i>&nbsp;{{tri}}</button>
                            <div ngbDropdownMenu aria-labelledby="dropdown1">
                                <li style="cursor: pointer" (click)="sortByDateDebut()" ngbDropdownItem>Date de début</li>
                                <li style="cursor: pointer" (click)="sortByDateFin()" ngbDropdownItem>Date d'échéance</li>
                                <li style="cursor: pointer" (click)="sortByPriority()" ngbDropdownItem>Priorité</li>
                            </div>
                        </div>
                        <div class="card" style="margin: 5px;">
                            <div class="example-list overflow-visible" style="width: 100%" cdkDropList (cdkDropListDropped)="onDropBacklog($event)">
                                <div cdkDrag [cdkDragDisabled]="isDisabled" [cdkDragData]="backlog" *ngFor="let backlog of backlogsProjet">
                                    <div class="example-container" style="height: 45px">
                                        <i (click)="backlogCollapses.toggle()" class="bi bi-chevron-down" style="cursor: pointer">&nbsp;</i>

                                        <i *ngIf="backlog.priorite == 1" class="fa fa-arrow-down fa-md text-primary" title="facultative">&nbsp;</i>
                                        <i *ngIf="backlog.priorite == 2" class="fa fa-chevron-down fa-md text-primary" title="basse">&nbsp;</i>
                                        <i *ngIf="backlog.priorite == 3" class="fa fa-minus fa-md text-warning" title="normale">&nbsp;</i>
                                        <i *ngIf="backlog.priorite == 4" class="fa fa-chevron-up fa-md text-danger" title="élevée">&nbsp;</i>
                                        <i *ngIf="backlog.priorite == 5" class="fa fa-arrow-up fa-md text-danger" title="urgente">&nbsp;</i>

                                        <b style="cursor: pointer" (click)="openBacklogModal(BacklogDetail,backlog.id)" *ngIf="backlog.abbreviate">{{backlog.abbreviate}} - </b>
                                        <span style="cursor: pointer" (click)="openBacklogModal(BacklogDetail,backlog.id)">{{backlog.nom}}</span>
                                        <ng-container *ngIf="backlog.sprints">
                                            &nbsp;<span *ngIf="backlog.sprints[0]" [style.backgroundColor]="backlog.sprints[0].couleur" style="color: white;font-weight: bold;cursor: pointer"><ng-container (click)="openSprintModal(SprintDetail,backlog.sprints[0])">&nbsp;{{backlog.sprints[0].nom}}&nbsp;</ng-container><i class="fa fa-times" style="cursor: pointer" (click)="deleteSprintBacklog(backlog,backlog.sprints[0])" aria-hidden="true"></i>&nbsp;</span>
                                            &nbsp;<span *ngIf="backlog.sprints[1]" [style.backgroundColor]="backlog.sprints[1].couleur" style="color: white;font-weight: bold;cursor: pointer"><ng-container (click)="openSprintModal(SprintDetail,backlog.sprints[1])">&nbsp;{{backlog.sprints[1].nom}}&nbsp;</ng-container><i class="fa fa-times" style="cursor: pointer" (click)="deleteSprintBacklog(backlog,backlog.sprints[1])" aria-hidden="true"></i>&nbsp;</span>
                                            &nbsp;
                                            <span *ngIf="backlog.sprints.length > 2" ngbDropdown #drop="ngbDropdown" (mouseover)='over(drop)' (mouseout)='out(drop)'>
                                                <span class="dropdown" ngbDropdownToggle style="background-color: gray;color: white;font-weight: bold;cursor: pointer">&nbsp;...&nbsp;</span>
                                                <div ngbDropdownMenu (mouseout)='out(drop)' class="dropdown-menu ml-3" aria-labelledby="dropdownMenuButton">
                                                    <ng-container *ngFor="let sprt of backlog.sprints; let i=index">
                                                        <div *ngIf="i >= 2" class="dropdown-item">
                                                            <span (click)="openSprintModal(SprintDetail,sprt)" style="float: left;cursor: pointer">{{sprt.nom}}</span>
                                                            <i class="fa fa-times" style="cursor: pointer;float: right;margin-top: 3px;margin-right: 5px" (click)="deleteSprintBacklog(backlog,backlog.sprints[i])" aria-hidden="true"></i><br>
                                                        </div>
                                                    </ng-container>
                                                </div>
                                            </span>
                                        </ng-container>
                                        <ng-container *ngFor="let responsable of scrumMastersBacklog">
                                            <div style="float: right" *ngIf="responsable.backlog.id == backlog.id">
                                                <a *ngIf="responsable.idScrumMaster && responsable.idScrumMaster.photo" role="button" aria-expanded="false" class="nav-link d-sm-flex align-items-sm-center">
                                                    <img
                                                        src="assets/{{responsable.idScrumMaster.photo}}"
                                                        alt=""
                                                        class="rounded-circle" style="width: 35px;height: 35px;cursor: pointer;"
                                                        title="{{responsable.idScrumMaster.username}}"
                                                    />
                                                </a>
                                                <a *ngIf="responsable.idScrumMaster && !responsable.idScrumMaster.photo" role="button" aria-expanded="false" class="nav-link d-sm-flex align-items-sm-center">
                                                    <img
                                                        src="assets/imageDefault.jpg"
                                                        alt=""
                                                        class="rounded-circle" style="width: 35px;height: 35px;cursor: pointer;"
                                                        title="{{responsable.idScrumMaster.username}}"
                                                    />
                                                </a>
                                            </div>
                                        </ng-container>
                                        <!-- <div style="float: right;margin: 10px; display: flex; align-items: center; justify-content: center;">
                                            <button class="btn btn-success" *ngIf="backlog.etat == 'Terminé'" style="height: 15px; padding: 0.5rem 0.5rem;"></button>
                                            <button class="btn btn-danger" *ngIf="backlog.etat == 'Pas valable'" style="height: 15px; padding: 0.5rem 0.5rem;"></button>
                                            <button class="btn btn-secondary" *ngIf="backlog.etat == 'en attente'" style="height: 15px; padding: 0.5rem 0.5rem;"></button>
                                            <button class="btn btn-primary" *ngIf="backlog.etat == 'Valable'" style="height: 15px; padding: 0.5rem 0.5rem;"></button>
                                        </div>     -->
                                        <p></p>
                                        <div *ngIf="backlog.etat != 'Pas valable'" class="progress rounded position-bottom" style="height: 5px;">
                                            <div class="progress-bar bg-secondary" role="progressbar" [style.width]="getFonctionnaliteAFaire(backlog)+'%'" [attr.aria-valuenow]="getFonctionnaliteAFaire(backlog)" aria-valuemin="0" aria-valuemax="100"></div>
                                            <div class="progress-bar bg-primary" role="progressbar" [style.width]="getFonctionnaliteEnProgres(backlog)+'%'" [attr.aria-valuenow]="getFonctionnaliteEnProgres(backlog)" aria-valuemin="0" aria-valuemax="100"></div>
                                            <div class="progress-bar bg-success" role="progressbar" [style.width]="getFonctionnaliteTermine(backlog)+'%'" [attr.aria-valuenow]="getFonctionnaliteTermine(backlog)" aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                        <div *ngIf="backlog.etat == 'Pas valable'" class="progress rounded position-bottom" style="height: 5px;">
                                            <div class="progress-bar bg-danger" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                    </div>                         
                                    <div id="collapseExample" mdbCollapse #backlogCollapses="mdbCollapse" class="col-md-8" style="position: static;margin-left: 10px;">
                                        <u>Modules</u>
                                        <ng-container *ngFor="let fonctionnalite of fonctionnalitesBacklog">
                                            <div *ngIf="backlog.id == fonctionnalite.backlog.id" class="example-list">
                                                <div class="example-box" style="cursor: pointer;width: 320px;height: 20px;margin: 10px" (click)="openFonctionnaliteModal(FonctionnaliteDetail,fonctionnalite)">
                                                    <div style="float: left">{{fonctionnalite.nom}}</div>
                                                    <div *ngIf="fonctionnalite.etat == 'à faire'" style="width: 20px;height: 20px;float: right;margin-right: 15px;background-color: gray;">
                                                    </div>
                                                    <div *ngIf="fonctionnalite.etat == 'En progrès'" style="width: 20px;height: 20px;float: right;margin-right: 15px;background-color: #007bff;">
                                                    </div>
                                                    <div *ngIf="fonctionnalite.etat == 'Terminé'" style="width: 20px;height: 20px;float: right;margin-right: 15px;background-color: green;">
                                                    </div>
                                                </div>
                                            </div>
                                        </ng-container>
                                        <input *ngIf="backlog.createFonction" type="text" class="form-control" placeholder="Nom du fonctionnalite" [(ngModel)]="fonctionnaliteName">
                                        <button *ngIf="!fonctionnaliteName && !backlog.createFonction" (click)="backlog.createFonction = true" class="col-md-12 btn btn-light text-center">Nouvelle Module</button>
                                        <button *ngIf="fonctionnaliteName" (click)="createFonctionnalite(backlog)" class="col-md-12 btn btn-light text-center">Créer Module</button>
                                        <button *ngIf="backlog.createFonction == true && !fonctionnaliteName" (click)="backlog.createFonction = false" class="col-md-12 btn btn-light text-center">Annuler</button>
                                    </div>
                                </div>
                            </div>
                            <div class="input-group">
                                <input *ngIf="newBacklogBool" type="text col-md-8" class="form-control input" (input)="getAbbreviation()" placeholder="Nom du backlog" [(ngModel)]="backlogName" style="width: 500px">&nbsp;
                                <input *ngIf="newBacklogBool" type="text col-md-8" class="form-control input" placeholder="Abbréviation" [(ngModel)]="backlogAbbr" style="width: 100px">
                            </div> 
                            <button *ngIf="!backlogName && !newBacklogBool && isProductOwner() || !backlogName && !newBacklogBool && isAdmin()" (click)="newBacklogBool = true" class="btn btn-light col-md-12 text-center">Nouveau backlog</button>
                            <button *ngIf="backlogName && backlogAbbr" (click)="createBacklog()" class="btn btn-light col-md-12 text-center">Créer backlog</button>
                            <button *ngIf="newBacklogBool == true && (!backlogName && !backlogAbbr || backlogName && !backlogAbbr || !backlogName && backlogAbbr)" (click)="newBacklogBool = false" class="btn btn-light col-md-12 text-center">Annuler</button>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card mb-4 mb-md-0">
                        <p style="margin-left: 20px;margin-top: 10px;" class="mb-4"><b><u>Sprints</u></b><button style="float: right;margin-right: 10px" class="btn btn-primary" (click)="createSprint()">New</button></p>
                        <div class="card" style="margin: 5px;">
                            <div class="example-list overflow-visible" style="width: 100%" *ngIf="sprintsProjet">
                                <div class="example-box" style="cursor: pointer" *ngFor="let sprint of sprintsProjet" ngbDropdown
                                cdkDropList [attr.id]="sprint.idSprint" (cdkDropListDropped)="onDropBacklogToSprint($event,sprint)">
                                    <div (click)="openSprintModal(SprintDetail,sprint)" style="float: left"><b>{{sprint.nom}}</b>&nbsp;<i *ngIf="sprint.etat == 'Terminé'" class="bi bi-check-lg text-success"></i>&nbsp; ( {{countBacklog(sprint)}} backlog(s) )</div>
                                    <button class="btn" ngbDropdownToggle *ngIf="sprint.couleur" [style.backgroundColor]="sprint.couleur" style="float: right;margin-top: 15px;margin-right: 15px;height: 15px; padding: 0.5rem 0.5rem;"></button>
                                    <ul
                                        ngbDropdownMenu
                                        class="dropdown-menu dropdown-menu-end"
                                        aria-labelledby="navbarDropdownMenuLink"
                                    >
                                        <li>
                                            <button style="width: 20px;height: 20px;background-color: red;float: right;margin-top: 15px;
                                            margin-right: 15px;" (click)="setSprintColor('red',sprint)" class="rounded-circle"></button>
                                            <button style="width: 20px;height: 20px;background-color: blue;float: right;margin-top: 15px;
                                            margin-right: 15px;" (click)="setSprintColor('blue',sprint)" class="rounded-circle"></button>
                                            <button style="width: 20px;height: 20px;background-color: green;float: right;margin-top: 15px;
                                            margin-right: 15px;" (click)="setSprintColor('green',sprint)" class="rounded-circle"></button>
                                            <button style="width: 20px;height: 20px;background-color: darkgoldenrod;float: right;margin-top: 15px;
                                            margin-right: 15px;" (click)="setSprintColor('darkgoldenrod',sprint)" class="rounded-circle"></button>
                                            <button style="width: 20px;height: 20px;background-color: darkmagenta;float: right;margin-top: 15px;
                                            margin-right: 15px;" (click)="setSprintColor('darkmagenta',sprint)" class="rounded-circle"></button>
                                            <button style="width: 20px;height: 20px;background-color: yellowgreen;float: right;margin-top: 15px;
                                            margin-right: 15px;" (click)="setSprintColor('yellowgreen',sprint)" class="rounded-circle"></button>
                                            <button style="width: 20px;height: 20px;background-color: brown;float: right;margin-top: 15px;
                                            margin-right: 15px;" (click)="setSprintColor('brown',sprint)" class="rounded-circle"></button>
                                            <button style="width: 20px;height: 20px;background-color: turquoise;float: right;margin-top: 15px;
                                            margin-right: 15px;" (click)="setSprintColor('turquoise',sprint)" class="rounded-circle"></button>
                                            <button style="width: 20px;height: 20px;background-color: orange;float: right;margin-top: 15px;
                                            margin-right: 15px;" (click)="setSprintColor('orange',sprint)" class="rounded-circle"></button>
                                            <button style="width: 20px;height: 20px;background-color: darkcyan;float: right;margin-top: 15px;
                                            margin-right: 15px;" (click)="setSprintColor('darkcyan',sprint)" class="rounded-circle"></button>
                                            <button style="width: 20px;height: 20px;background-color: skyblue;float: right;margin-top: 15px;
                                            margin-right: 15px;" (click)="setSprintColor('skyblue',sprint)" class="rounded-circle"></button>
                                            <button style="width: 20px;height: 20px;background-color: darksalmon;float: right;margin-top: 15px;
                                            margin-right: 15px;" (click)="setSprintColor('darksalmon',sprint)" class="rounded-circle"></button>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div *ngIf="!isLogged">
    <p>Vous devez d'abord vous connecter</p>
    <a class="btn btn-primary" href="/">Retour</a>
</div>